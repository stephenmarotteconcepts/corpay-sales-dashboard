<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Dashboard 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', system-ui, sans-serif; }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 5px #ef4444; } 50% { box-shadow: 0 0 20px #ef4444; } }
    .listening { animation: pulse-glow 1s infinite; }
    .optimal { background: linear-gradient(90deg, #dcfce7, #bbf7d0); }
    .avoid { background: linear-gradient(90deg, #fee2e2, #fecaca); }
    input::-webkit-inner-spin-button { opacity: 0; }
    input:hover::-webkit-inner-spin-button { opacity: 1; }
    .sync-pulse { animation: syncPulse 1s infinite; }
    @keyframes syncPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .dark body { background: #0f172a; color: #e2e8f0; }
    .dark .bg-white { background: #1e293b !important; }
    .dark .bg-slate-50 { background: #0f172a !important; }
    .dark .bg-gray-50, .dark .bg-gray-100 { background: #334155 !important; }
    .dark .text-gray-900, .dark .text-gray-800, .dark .text-gray-700 { color: #e2e8f0 !important; }
    .dark .text-gray-600, .dark .text-gray-500 { color: #94a3b8 !important; }
    .dark .border { border-color: #475569 !important; }
    .dark input, .dark select { background: #334155 !important; color: #e2e8f0 !important; border-color: #475569 !important; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
<div id="app"></div>
<div id="toast" class="fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 transform translate-y-20 opacity-0 pointer-events-none"><span id="toast-msg"></span></div>

<script>
// JSONBIN CONFIG
const JSONBIN_KEY = '$2a$10$/U.VcMOsSVGv.U3dsQVMCuoT6tCgV8h03geLfIdp0O2S7KE2aleuC';
const STORAGE_KEY = 'salesDash2026';
const BIN_ID_KEY = 'salesDash2026_binId';

let syncStatus = 'idle';
let lastSyncTime = null;
let syncTimeout = null;
let binId = localStorage.getItem(BIN_ID_KEY);

const HOLIDAYS = [
  {d:'2026-01-01',n:"New Year's Day"},{d:'2026-01-19',n:'MLK Day'},{d:'2026-02-16',n:"Presidents' Day"},
  {d:'2026-05-25',n:'Memorial Day'},{d:'2026-06-19',n:'Juneteenth'},{d:'2026-07-03',n:'Independence Day'},
  {d:'2026-09-07',n:'Labor Day'},{d:'2026-10-12',n:'Columbus Day'},{d:'2026-11-11',n:'Veterans Day'}
];

const CALL_TIMES = {
  best: [{t:'10:00-11:30',l:'Prime Morning',n:'46% higher connects'},{t:'16:00-17:00',l:'Prime Afternoon',n:'Highest conversions'}],
  avoid: [{t:'08:00-10:00',r:'Email catch-up, meetings'},{t:'12:00-14:00',r:'Lunch hours'}],
  bestDays: ['Tuesday','Wednesday','Thursday'], worstDays: ['Monday','Friday']
};

const DEFAULTS = {
  name: '2026 Sales Dashboard', quota: 360000, targetPct: 150, dealSize: 9000, closeRate: 25,
  callsPerAppt: 25, emailsPerAppt: 25, apptSplitCalls: 80, totalWeeks: 46, ptoWeeks: 7,
  callDaysPerWeek: 4, acctsPerMonday: 7, darkMode: false
};

function emptyWeek(num = 1) {
  return { num, mon: { accts: 0, emails: 0, li: 0, pto: false }, tue: { calls: 0, emails: 0, li: 0, appts: 0, pto: false }, wed: { calls: 0, emails: 0, li: 0, appts: 0, pto: false }, thu: { calls: 0, emails: 0, li: 0, appts: 0, pto: false }, fri: { calls: 0, emails: 0, li: 0, appts: 0, pto: false } };
}

function emptyPipeline() {
  return { q1: { value: 250000, closeRate: 25 }, q2: { value: 0, closeRate: 25 }, q3: { value: 0, closeRate: 25 }, q4: { value: 0, closeRate: 25 } };
}

function emptyData() {
  return { settings: { ...DEFAULTS }, week: emptyWeek(1), ytd: { weeks: 0, accts: 0, calls: 0, emails: 0, li: 0, appts: 0, deals: 0, rev: 0, ptoDays: 0 }, pipeline: emptyPipeline(), history: [], deals: [], streak: { current: 0, best: 0, lastDate: null } };
}

let data = emptyData();
let ui = { tab: 'dash', listening: false, voiceMsg: '', showSettings: false, quick: { day: 'tue', metric: 'calls', val: '' }, loading: true };

async function createBin() {
  try {
    const response = await fetch('https://api.jsonbin.io/v3/b', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY, 'X-Bin-Name': 'sales-dashboard-2026' },
      body: JSON.stringify(data)
    });
    if (!response.ok) throw new Error('Failed to create bin');
    const result = await response.json();
    binId = result.metadata.id;
    localStorage.setItem(BIN_ID_KEY, binId);
    return true;
  } catch (err) { console.error('Create bin failed:', err); return false; }
}

async function loadFromCloud() {
  const local = localStorage.getItem(STORAGE_KEY);
  if (local) {
    try {
      const parsed = JSON.parse(local);
      if (parsed && parsed.settings) {
        data = { settings: { ...DEFAULTS, ...parsed.settings }, week: parsed.week || emptyWeek(1), ytd: parsed.ytd || emptyData().ytd, pipeline: parsed.pipeline || emptyPipeline(), history: parsed.history || [], deals: parsed.deals || [], streak: parsed.streak || { current: 0, best: 0, lastDate: null } };
      }
    } catch (e) { console.log('localStorage parse error:', e); }
  }
  ui.loading = false;
  syncStatus = 'syncing';
  render();
  
  if (!binId) {
    const created = await createBin();
    syncStatus = created ? 'synced' : 'error';
    if (created) lastSyncTime = new Date();
    render();
    return;
  }
  
  try {
    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, { headers: { 'X-Master-Key': JSONBIN_KEY } });
    if (!response.ok) throw new Error('Failed to load');
    const result = await response.json();
    const cloudData = result.record;
    if (cloudData && cloudData.settings) {
      const cloudWeeks = cloudData.ytd?.weeks || 0;
      const localWeeks = data.ytd?.weeks || 0;
      if (cloudWeeks >= localWeeks || !local) {
        data = { settings: { ...DEFAULTS, ...cloudData.settings }, week: cloudData.week || emptyWeek(1), ytd: cloudData.ytd || emptyData().ytd, pipeline: cloudData.pipeline || emptyPipeline(), history: cloudData.history || [], deals: cloudData.deals || [], streak: cloudData.streak || { current: 0, best: 0, lastDate: null } };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }
    }
    syncStatus = 'synced';
    lastSyncTime = new Date();
    render();
  } catch (err) { console.error('Load from cloud failed:', err); syncStatus = 'error'; render(); }
}

async function saveToCloud() {
  if (!binId) { await createBin(); return; }
  try {
    syncStatus = 'syncing'; render();
    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY },
      body: JSON.stringify(data)
    });
    if (!response.ok) throw new Error('Failed to save');
    syncStatus = 'synced';
    lastSyncTime = new Date();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    render();
  } catch (err) { console.error('Save to cloud failed:', err); syncStatus = 'error'; localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); render(); }
}

function debouncedSave() {
  if (syncTimeout) clearTimeout(syncTimeout);
  syncStatus = 'syncing'; render();
  syncTimeout = setTimeout(() => saveToCloud(), 2000);
}

function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); debouncedSave(); }

function toast(msg, color = 'emerald') {
  const t = document.getElementById('toast');
  t.className = `fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 bg-${color}-600 text-white`;
  document.getElementById('toast-msg').textContent = msg;
  t.classList.remove('translate-y-20', 'opacity-0', 'pointer-events-none');
  setTimeout(() => t.classList.add('translate-y-20', 'opacity-0', 'pointer-events-none'), 2500);
}

function getWorkingWeeks() { return data.settings.totalWeeks - data.settings.ptoWeeks; }

function targets() {
  const s = data.settings;
  const workWeeks = getWorkingWeeks();
  const rev = s.quota * s.targetPct / 100;
  const deals = Math.ceil(rev / s.dealSize);
  const appts = Math.ceil(deals / (s.closeRate / 100));
  const callAppts = Math.ceil(appts * s.apptSplitCalls / 100);
  const calls = callAppts * s.callsPerAppt;
  const emails = (appts - callAppts) * s.emailsPerAppt;
  return { rev, deals, appts, calls, emails, accts: workWeeks * s.acctsPerMonday, wk: { accts: s.acctsPerMonday, calls: Math.ceil(calls / workWeeks), emails: Math.ceil(emails / workWeeks), li: 15, appts: Math.ceil(appts / workWeeks) }, dy: { calls: Math.ceil(calls / (workWeeks * s.callDaysPerWeek)) } };
}

function weekTotals() {
  const w = data.week;
  return { accts: w.mon.pto ? 0 : w.mon.accts, calls: ['tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].calls), 0), emails: ['mon','tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].emails), 0), li: ['mon','tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].li), 0), appts: ['tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].appts), 0), ptoDays: ['mon','tue','wed','thu','fri'].filter(d => w[d].pto).length };
}

function combined() { const wk = weekTotals(); return { accts: data.ytd.accts + wk.accts, calls: data.ytd.calls + wk.calls, emails: data.ytd.emails + wk.emails, appts: data.ytd.appts + wk.appts, deals: data.ytd.deals, rev: data.ytd.rev }; }

function pipelineTotal() { const p = data.pipeline; return { total: p.q1.value + p.q2.value + p.q3.value + p.q4.value, projected: (p.q1.value * p.q1.closeRate / 100) + (p.q2.value * p.q2.closeRate / 100) + (p.q3.value * p.q3.closeRate / 100) + (p.q4.value * p.q4.closeRate / 100) }; }

function upcomingHolidays() { const today = new Date().toISOString().split('T')[0]; return HOLIDAYS.filter(h => h.d >= today).slice(0, 3); }

function getCurrentQuarter() { const m = new Date().getMonth(); return m < 3 ? 'q1' : m < 6 ? 'q2' : m < 9 ? 'q3' : 'q4'; }

function formatMoney(v) { return v >= 1000000 ? `$${(v/1000000).toFixed(1)}M` : v >= 1000 ? `$${(v/1000).toFixed(0)}K` : `$${v}`; }

function pct(c, t) { return t ? Math.min(c / t * 100, 100).toFixed(0) : 0; }

function setDay(day, field, val) { if (field === 'pto') data.week[day].pto = val; else data.week[day][field] = parseInt(val) || 0; updateStreak(); save(); render(); }

function setSetting(key, val) { data.settings[key] = typeof val === 'string' && !isNaN(val) ? Number(val) : val; if (key === 'darkMode') document.documentElement.classList.toggle('dark', val); save(); render(); }

function setPipeline(q, field, val) { data.pipeline[q][field] = parseInt(val) || 0; save(); render(); }

function closeWeek() {
  if (!confirm(`Close Week ${data.week.num}?`)) return;
  const t = weekTotals();
  data.history.push({ num: data.week.num, closed: new Date().toISOString(), ...t });
  data.ytd.weeks++; data.ytd.accts += t.accts; data.ytd.calls += t.calls; data.ytd.emails += t.emails; data.ytd.li += t.li; data.ytd.appts += t.appts; data.ytd.ptoDays += t.ptoDays;
  data.week = emptyWeek(data.week.num + 1);
  save(); toast('âœ“ Week closed!'); render();
}

function addDeal(amt, q = null) { q = q || getCurrentQuarter(); data.ytd.deals++; data.ytd.rev += amt; data.deals.push({ amount: amt, date: new Date().toISOString(), quarter: q }); save(); toast(`âœ“ Deal added: ${formatMoney(amt)}`); render(); }

function updateStreak() { const today = new Date().toISOString().split('T')[0]; const T = targets(); const td = ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()]; if (td !== 'sun' && td !== 'sat' && td !== 'mon') { const dd = data.week[td]; if (dd && (dd.calls >= T.dy.calls || dd.pto) && data.streak.lastDate !== today) { data.streak.current++; data.streak.best = Math.max(data.streak.best, data.streak.current); data.streak.lastDate = today; } } }

function quickDay(type) { const T = targets(); const td = ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()]; if (td === 'sun' || td === 'sat') { toast('âš ï¸ Weekend!', 'amber'); return; } if (type === 'pto') data.week[td].pto = true; else if (type === 'good') { if (td === 'mon') data.week.mon.accts = T.wk.accts; else { data.week[td].calls = T.dy.calls; data.week[td].appts = Math.ceil(T.wk.appts / 4); } } else if (type === 'light') { if (td === 'mon') data.week.mon.accts = Math.ceil(T.wk.accts / 2); else data.week[td].calls = Math.ceil(T.dy.calls / 2); } save(); toast(`âœ“ ${type} day logged`); render(); }

function startVoice() { if (!('webkitSpeechRecognition' in window)) { ui.voiceMsg = 'âŒ Use Chrome'; render(); return; } const rec = new webkitSpeechRecognition(); rec.continuous = false; rec.lang = 'en-US'; rec.onstart = () => { ui.listening = true; ui.voiceMsg = 'ğŸ¤ Listening...'; render(); }; rec.onresult = (e) => parseVoice(e.results[0][0].transcript.toLowerCase()); rec.onerror = (e) => { ui.listening = false; ui.voiceMsg = 'âŒ ' + e.error; render(); }; rec.onend = () => { ui.listening = false; render(); }; rec.start(); }

function parseVoice(t) { const dayMap = { monday: 'mon', tuesday: 'tue', wednesday: 'wed', thursday: 'thu', friday: 'fri', today: ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()] }; const metricMap = { calls: 'calls', call: 'calls', dials: 'calls', emails: 'emails', email: 'emails', linkedin: 'li', appointments: 'appts', appointment: 'appts', booked: 'appts', accounts: 'accts', account: 'accts' }; let fd = null, fm = null; for (const [w, d] of Object.entries(dayMap)) if (t.includes(w)) { fd = d; break; } for (const [w, m] of Object.entries(metricMap)) if (t.includes(w)) { fm = m; break; } const nm = t.match(/\d+/); const fn = nm ? parseInt(nm[0]) : null; if (fd && fm && fn !== null) { if (fd === 'mon' && fm === 'accts') data.week.mon.accts += fn; else if (data.week[fd] && fm in data.week[fd]) data.week[fd][fm] += fn; save(); ui.voiceMsg = `âœ… +${fn} ${fm} â†’ ${fd}`; } else ui.voiceMsg = `â“ "${t}"`; render(); }

function quickAdd() { const { day, metric, val } = ui.quick; if (!val) return; const n = parseInt(val); if (day === 'mon' && metric === 'accts') data.week.mon.accts += n; else if (data.week[day] && metric in data.week[day]) data.week[day][metric] += n; save(); ui.quick.val = ''; render(); }

function syncIndicator() { const colors = { idle: 'bg-gray-400', syncing: 'bg-yellow-400 sync-pulse', synced: 'bg-green-500', error: 'bg-red-500' }; const labels = { idle: 'Ready', syncing: 'Syncing...', synced: lastSyncTime ? `Synced ${lastSyncTime.toLocaleTimeString()}` : 'Synced', error: 'Sync error' }; return `<div class="flex items-center gap-2 text-xs"><div class="w-2 h-2 rounded-full ${colors[syncStatus]}"></div><span class="text-blue-100">${labels[syncStatus]}</span></div>`; }

function progressBar(c, t, l, color = 'bg-blue-500') { const p = pct(c, t); const done = c >= t; return `<div class="mb-3"><div class="flex justify-between text-sm mb-1"><span class="font-medium">${l}</span><span class="${done ? 'text-green-600 font-bold' : 'text-gray-600'}">${c}/${t}${done ? ' âœ“' : ''}</span></div><div class="h-3 bg-gray-200 rounded-full overflow-hidden"><div class="h-full ${done ? 'bg-green-500' : color}" style="width:${p}%"></div></div></div>`; }

function statCard(title, val, tar, sub, hl = false) { const p = tar ? pct(val, tar) : null; const d = val >= 1000 ? formatMoney(val) : val; return `<div class="bg-white rounded-xl p-4 shadow-sm border ${hl ? 'ring-2 ring-blue-200' : ''}"><p class="text-gray-500 text-sm">${title}</p><p class="text-2xl font-bold mt-1">${d}</p>${p !== null ? `<p class="text-sm ${p >= 100 ? 'text-green-600' : 'text-amber-600'}">${p}%</p>` : ''}${sub ? `<p class="text-xs text-gray-400 mt-1">${sub}</p>` : ''}</div>`; }

function render() {
  if (ui.loading) { document.getElementById('app').innerHTML = `<div class="min-h-screen flex items-center justify-center"><div class="text-center"><div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div><p class="text-gray-600">Loading...</p></div></div>`; return; }
  const T = targets(); const wk = weekTotals(); const comb = combined(); const hols = upcomingHolidays(); const pipe = pipelineTotal(); const s = data.settings; const gap = Math.max(0, T.rev - data.ytd.rev - pipe.projected); const dayNames = { mon: 'Monday', tue: 'Tuesday', wed: 'Wednesday', thu: 'Thursday', fri: 'Friday' }; const td = ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()]; const isWD = td !== 'sun' && td !== 'sat'; const cQ = getCurrentQuarter();
  document.documentElement.classList.toggle('dark', s.darkMode);
  document.getElementById('app').innerHTML = `
<div class="max-w-5xl mx-auto p-4 pb-20">
  <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 mb-6 text-white shadow-lg">
    <div class="flex flex-wrap justify-between gap-4">
      <div><div class="flex items-center gap-3 mb-1"><h1 class="text-2xl font-bold">${s.name}</h1></div><p class="text-blue-100">Week ${data.week.num} of ${getWorkingWeeks()} â€¢ Target ${s.targetPct}% (${formatMoney(T.rev)})</p>${syncIndicator()}</div>
      <div class="text-right"><p class="text-3xl font-bold">${formatMoney(comb.rev)}</p><p class="text-blue-100 text-sm">Revenue</p><div class="flex gap-2 mt-2 justify-end"><button onclick="ui.showSettings=!ui.showSettings;render()" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">âš™ï¸</button><button onclick="setSetting('darkMode', !data.settings.darkMode)" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">${s.darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</button></div></div>
    </div>
    <div class="mt-4 bg-white/10 rounded-lg p-3"><div class="flex justify-between text-sm"><span>Progress</span><span class="font-semibold">${(comb.rev / T.rev * 100).toFixed(1)}%</span></div><div class="h-3 bg-white/20 rounded-full mt-2 overflow-hidden"><div class="h-full bg-gradient-to-r from-green-400 to-emerald-400" style="width:${Math.min(comb.rev / T.rev * 100, 100)}%"></div></div><div class="flex justify-between text-xs text-blue-200 mt-1"><span>${comb.deals} deals</span><span>${T.deals - comb.deals} to go</span></div></div>
    <div class="mt-3 flex items-center gap-4 text-sm"><span class="bg-white/20 px-3 py-1 rounded-full">ğŸ”¥ ${data.streak.current} day streak</span><span class="text-blue-200">Best: ${data.streak.best}</span></div>
  </div>

  ${ui.showSettings ? `<div class="bg-white rounded-xl p-6 shadow-lg border-2 border-blue-200 mb-6"><div class="flex justify-between mb-4"><h2 class="font-bold text-lg">âš™ï¸ Settings</h2><button onclick="ui.showSettings=false;render()" class="text-2xl text-gray-400">&times;</button></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"><div><label class="text-xs text-gray-500">Name</label><input value="${s.name}" onchange="setSetting('name',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Quota ($)</label><input type="number" value="${s.quota}" onchange="setSetting('quota',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Target %</label><input type="number" value="${s.targetPct}" onchange="setSetting('targetPct',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Deal Size ($)</label><input type="number" value="${s.dealSize}" onchange="setSetting('dealSize',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Close Rate %</label><input type="number" value="${s.closeRate}" onchange="setSetting('closeRate',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Calls/Appt</label><input type="number" value="${s.callsPerAppt}" onchange="setSetting('callsPerAppt',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">Total Weeks</label><input type="number" value="${s.totalWeeks}" onchange="setSetting('totalWeeks',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div><div><label class="text-xs text-gray-500">PTO Weeks</label><input type="number" value="${s.ptoWeeks}" onchange="setSetting('ptoWeeks',this.value)" class="w-full p-2 border rounded mt-1 text-sm"></div></div><div class="text-xs text-gray-500 bg-gray-50 p-3 rounded"><strong>Calc:</strong> ${getWorkingWeeks()} weeks â†’ ${T.deals} deals â†’ ${T.calls.toLocaleString()} calls</div></div>` : ''}

  <div class="flex gap-2 mb-6 overflow-x-auto pb-1">${['dash', 'pipe', 'sched', 'history'].map(tab => `<button onclick="ui.tab='${tab}';render()" class="px-4 py-2 rounded-lg font-medium whitespace-nowrap ${ui.tab === tab ? 'bg-blue-600 text-white shadow' : 'bg-white border hover:bg-gray-50'}">${{ dash: 'ğŸ“Š Dashboard', pipe: 'ğŸ’° Pipeline', sched: 'ğŸ“… Schedule', history: 'ğŸ“ˆ History' }[tab]}</button>`).join('')}</div>

  ${ui.tab === 'dash' ? `
  ${isWD ? `<div class="bg-white rounded-xl p-4 shadow-sm border mb-6"><div class="flex flex-wrap items-center gap-3"><span class="font-medium">Quick Log:</span><button onclick="quickDay('good')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium">âœ“ Good Day</button><button onclick="quickDay('light')" class="px-4 py-2 bg-amber-500 text-white rounded-lg font-medium">Â½ Light</button><button onclick="quickDay('pto')" class="px-4 py-2 bg-gray-500 text-white rounded-lg font-medium">ğŸ–ï¸ PTO</button><span class="text-sm text-gray-500 ml-auto">${dayNames[td] || ''}</span></div></div>` : ''}
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">${statCard('Deals', comb.deals, T.deals, `${T.deals - comb.deals} to go`)}${statCard('Appointments', comb.appts, Math.ceil((data.ytd.weeks + 1) * T.wk.appts), `Week: +${wk.appts}`, wk.appts > 0)}${statCard('Calls', comb.calls, Math.ceil((data.ytd.weeks + 1) * T.wk.calls), `Week: +${wk.calls}`, wk.calls > 0)}${statCard('Accounts', comb.accts, Math.ceil((data.ytd.weeks + 1) * T.wk.accts), `Week: +${wk.accts}`, wk.accts > 0)}</div>
  ${hols.length ? `<div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6"><h3 class="font-semibold text-amber-800 mb-2">ğŸ“… Upcoming</h3><div class="flex flex-wrap gap-2">${hols.map(h => `<span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm">${h.n}</span>`).join('')}</div></div>` : ''}
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6"><h2 class="font-semibold mb-3">âš¡ Quick Update</h2><div class="flex flex-wrap gap-3 items-center"><button onclick="startVoice()" class="px-4 py-2 rounded-lg font-medium ${ui.listening ? 'bg-red-500 text-white listening' : 'bg-blue-600 text-white'}">${ui.listening ? 'ğŸ¤...' : 'ğŸ¤ Voice'}</button><select onchange="ui.quick.day=this.value" class="p-2 border rounded-lg">${['mon','tue','wed','thu','fri'].map(d => `<option value="${d}" ${ui.quick.day === d ? 'selected' : ''}>${dayNames[d]}</option>`).join('')}</select><select onchange="ui.quick.metric=this.value" class="p-2 border rounded-lg">${[['calls','Calls'],['emails','Emails'],['appts','Appts'],['accts','Accts']].map(([v,l]) => `<option value="${v}" ${ui.quick.metric === v ? 'selected' : ''}>${l}</option>`).join('')}</select><input type="number" value="${ui.quick.val}" oninput="ui.quick.val=this.value" onkeypress="if(event.key==='Enter')quickAdd()" placeholder="#" class="w-16 p-2 border rounded-lg text-center font-bold"><button onclick="quickAdd()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium">+</button></div>${ui.voiceMsg ? `<p class="text-sm mt-2 ${ui.voiceMsg.startsWith('âœ…') ? 'text-green-600' : 'text-gray-500'}">${ui.voiceMsg}</p>` : ''}</div>
  <div class="grid md:grid-cols-2 gap-6 mb-6"><div class="bg-white rounded-xl p-4 shadow-sm border"><h2 class="font-semibold mb-4">Week ${data.week.num}</h2>${progressBar(wk.accts, T.wk.accts, 'Accounts', 'bg-purple-500')}${progressBar(wk.calls, T.wk.calls, 'Calls', 'bg-blue-500')}${progressBar(wk.appts, T.wk.appts, 'Appts', 'bg-green-500')}</div><div class="bg-white rounded-xl p-4 shadow-sm border"><h2 class="font-semibold mb-4">Daily Entry</h2><table class="w-full text-sm"><thead><tr class="text-gray-500 text-xs"><th class="text-left py-2">Day</th><th>PTO</th><th>Accts</th><th>Calls</th><th>Appts</th></tr></thead><tbody>${['mon','tue','wed','thu','fri'].map(d => { const day = data.week[d]; const isToday = d === td; return `<tr class="border-t ${isToday ? 'bg-blue-50' : ''} ${day.pto ? 'opacity-50' : ''}"><td class="py-2 font-medium ${isToday ? 'text-blue-700' : ''}">${dayNames[d].slice(0,3)}${isToday ? 'â€¢' : ''}</td><td class="text-center"><input type="checkbox" ${day.pto ? 'checked' : ''} onchange="setDay('${d}','pto',this.checked)" class="w-4 h-4"></td><td class="text-center">${d === 'mon' ? `<input type="number" value="${day.accts || ''}" onchange="setDay('${d}','accts',this.value)" class="w-12 p-1 border rounded text-center">` : 'â€”'}</td><td class="text-center">${d !== 'mon' ? `<input type="number" value="${day.calls || ''}" onchange="setDay('${d}','calls',this.value)" class="w-12 p-1 border rounded text-center">` : 'â€”'}</td><td class="text-center">${d !== 'mon' ? `<input type="number" value="${day.appts || ''}" onchange="setDay('${d}','appts',this.value)" class="w-12 p-1 border rounded text-center">` : 'â€”'}</td></tr>`; }).join('')}<tr class="border-t-2 font-bold bg-gray-50"><td class="py-2" colspan="2">Total</td><td class="text-center">${wk.accts}</td><td class="text-center">${wk.calls}</td><td class="text-center">${wk.appts}</td></tr></tbody></table></div></div>
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6"><div class="flex flex-wrap gap-3 items-center"><button onclick="closeWeek()" class="px-5 py-2 bg-green-600 text-white rounded-lg font-medium">âœ“ Close Week</button><button onclick="addDeal(${s.dealSize})" class="px-5 py-2 bg-blue-600 text-white rounded-lg font-medium">+ Deal (${formatMoney(s.dealSize)})</button><button onclick="const a=prompt('Amount?','${s.dealSize}');if(a)addDeal(+a)" class="px-4 py-2 bg-gray-100 rounded-lg">+ Custom</button><span class="ml-auto text-sm text-gray-500">${data.ytd.weeks}wk â€¢ ${comb.deals} deals â€¢ ${formatMoney(comb.rev)}</span></div></div>
  <div class="bg-gray-100 rounded-xl p-4"><h2 class="font-semibold mb-3">YTD</h2><div class="grid grid-cols-3 md:grid-cols-6 gap-3 text-center"><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.weeks}</p><p class="text-xs text-gray-500">Weeks</p></div><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.calls.toLocaleString()}</p><p class="text-xs text-gray-500">Calls</p></div><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.emails}</p><p class="text-xs text-gray-500">Emails</p></div><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.accts}</p><p class="text-xs text-gray-500">Accts</p></div><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.appts}</p><p class="text-xs text-gray-500">Appts</p></div><div class="bg-white rounded-lg p-3"><p class="text-xl font-bold text-green-600">${data.ytd.deals}</p><p class="text-xs text-gray-500">Deals</p></div></div></div>
  ` : ''}

  ${ui.tab === 'pipe' ? `<div class="bg-white rounded-xl p-6 shadow-sm border mb-6"><h2 class="font-semibold mb-4">ğŸ’° Pipeline by Quarter</h2><div class="grid md:grid-cols-4 gap-4 mb-6">${['q1','q2','q3','q4'].map(q => { const qd = data.pipeline[q]; const proj = qd.value * qd.closeRate / 100; const isCur = q === cQ; return `<div class="rounded-xl p-4 ${isCur ? 'bg-blue-50 ring-2 ring-blue-200' : 'bg-gray-50'}"><div class="flex justify-between items-center mb-3"><h3 class="font-bold">${q.toUpperCase()}</h3>${isCur ? '<span class="text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full">Now</span>' : ''}</div><div class="mb-3"><label class="text-xs text-gray-500">Value</label><div class="flex items-center"><span>$</span><input type="number" value="${qd.value}" onchange="setPipeline('${q}','value',this.value)" class="w-full p-2 border rounded font-bold"></div></div><div class="mb-3"><label class="text-xs text-gray-500">Close %</label><input type="number" value="${qd.closeRate}" onchange="setPipeline('${q}','closeRate',this.value)" class="w-full p-2 border rounded"></div><div class="bg-white rounded p-2 text-center"><p class="text-xs text-gray-500">Projected</p><p class="font-bold text-green-600">${formatMoney(proj)}</p></div></div>`; }).join('')}</div><div class="bg-gray-50 rounded-xl p-4"><div class="grid md:grid-cols-2 gap-6"><div><h3 class="font-medium mb-3">Summary</h3><div class="space-y-2 text-sm"><div class="flex justify-between py-2 border-b"><span>Total Pipeline</span><span class="font-bold">${formatMoney(pipe.total)}</span></div><div class="flex justify-between py-2 border-b"><span>Projected</span><span class="font-bold text-green-600">${formatMoney(pipe.projected)}</span></div><div class="flex justify-between py-2"><span>YTD Closed</span><span class="font-bold text-green-600">${formatMoney(data.ytd.rev)}</span></div></div></div><div><h3 class="font-medium mb-3">Gap Analysis</h3><div class="space-y-2 text-sm"><div class="flex justify-between py-2 border-b"><span>Target</span><span class="font-bold">${formatMoney(T.rev)}</span></div><div class="flex justify-between py-2 bg-amber-50 px-3 rounded font-bold text-amber-800"><span>Gap</span><span>${formatMoney(gap)}</span></div><div class="flex justify-between py-2"><span>Deals Needed</span><span class="font-semibold">${Math.ceil(gap / s.dealSize)}</span></div></div></div></div></div></div>` : ''}

  ${ui.tab === 'sched' ? `<div class="bg-white rounded-xl p-6 shadow-sm border mb-6"><h2 class="font-semibold mb-4">â° Best Calling Times</h2><div class="bg-blue-50 p-3 rounded-lg mb-4"><p class="text-sm text-blue-800"><strong>Finance/Ops:</strong> 10-11 AM & 4-5 PM best. Avoid month-end.</p></div><div class="grid md:grid-cols-2 gap-4 mb-4"><div><h3 class="font-medium text-green-700 mb-2">âœ… Best</h3>${CALL_TIMES.best.map(t => `<div class="optimal p-3 rounded-lg mb-2"><p class="font-bold">${t.t}</p><p class="text-sm">${t.l}</p></div>`).join('')}</div><div><h3 class="font-medium text-red-700 mb-2">âŒ Avoid</h3>${CALL_TIMES.avoid.map(t => `<div class="avoid p-3 rounded-lg mb-2"><p class="font-bold">${t.t}</p><p class="text-sm">${t.r}</p></div>`).join('')}</div></div><div class="border-t pt-4"><h3 class="font-medium mb-2">Best Days</h3><div class="flex gap-2">${['Mon','Tue','Wed','Thu','Fri'].map(d => `<span class="px-4 py-2 rounded-full text-sm font-medium ${CALL_TIMES.bestDays.includes(d+'day') || ['Tuesday','Wednesday','Thursday'].some(x => x.startsWith(d)) ? 'bg-green-100 text-green-800' : CALL_TIMES.worstDays.includes(d+'day') || ['Monday','Friday'].some(x => x.startsWith(d)) ? 'bg-red-100 text-red-800' : 'bg-gray-100'}">${d}</span>`).join('')}</div></div></div><div class="grid md:grid-cols-2 gap-6"><div class="bg-white rounded-xl p-6 shadow-sm border"><h2 class="font-semibold mb-4">ğŸ“… Monday: Research</h2><ul class="space-y-2 text-sm"><li>8-9:30 â€¢ Team mtgs</li><li class="bg-purple-50 px-2 py-1 rounded">9:30-12 â€¢ <strong>Build 4 accts</strong></li><li>12-1 â€¢ Lunch</li><li class="bg-purple-50 px-2 py-1 rounded">1-2:30 â€¢ <strong>Build 3 accts</strong></li><li>2:30-4:30 â€¢ Planning</li></ul><p class="mt-3 text-sm font-medium text-purple-700 bg-purple-50 p-2 rounded">ğŸ“¦ ${T.wk.accts} accounts</p></div><div class="bg-white rounded-xl p-6 shadow-sm border"><h2 class="font-semibold mb-4">ğŸ“ Tue-Fri: Calling</h2><ul class="space-y-2 text-sm"><li>8-8:30 â€¢ Prep</li><li class="optimal px-2 py-1 rounded">8:30-10:30 â€¢ <strong>Block #1</strong></li><li class="optimal px-2 py-1 rounded">10:30-12 â€¢ <strong>Block #2</strong></li><li>12-1 â€¢ Lunch</li><li>1-2:30 â€¢ Meetings</li><li class="optimal px-2 py-1 rounded">3-4 â€¢ <strong>Block #3</strong></li></ul><p class="mt-3 text-sm font-medium text-blue-700 bg-blue-50 p-2 rounded">ğŸ“ ${T.dy.calls} calls/day</p></div></div>` : ''}

  ${ui.tab === 'history' ? `<div class="grid md:grid-cols-2 gap-6"><div class="bg-white rounded-xl p-6 shadow-sm border"><h2 class="font-semibold mb-4">ğŸ“Š Weeks</h2>${data.history.length ? `<div class="max-h-80 overflow-auto"><table class="w-full text-sm"><thead class="bg-gray-100 sticky top-0"><tr><th class="text-left p-2">Wk</th><th class="text-center p-2">Calls</th><th class="text-center p-2">Appts</th></tr></thead><tbody>${data.history.slice().reverse().map(w => `<tr class="border-b"><td class="p-2">Week ${w.num}</td><td class="text-center p-2">${w.calls}</td><td class="text-center p-2">${w.appts}</td></tr>`).join('')}</tbody></table></div>` : '<p class="text-gray-500">No weeks yet</p>'}</div><div class="bg-white rounded-xl p-6 shadow-sm border"><h2 class="font-semibold mb-4">ğŸ’µ Deals</h2>${data.deals.length ? `<div class="max-h-80 overflow-auto"><table class="w-full text-sm"><thead class="bg-gray-100 sticky top-0"><tr><th class="text-left p-2">Date</th><th class="text-right p-2">Amount</th></tr></thead><tbody>${data.deals.slice().reverse().map(d => `<tr class="border-b"><td class="p-2">${new Date(d.date).toLocaleDateString()}</td><td class="text-right p-2 text-green-600 font-medium">${formatMoney(d.amount)}</td></tr>`).join('')}</tbody></table></div>` : '<p class="text-gray-500">No deals yet</p>'}</div></div>` : ''}
</div>`;
}

loadFromCloud();
</script>
</body>
</html>
