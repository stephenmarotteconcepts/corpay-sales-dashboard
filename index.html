<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Sales Dashboard - Stephen Marcotte</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', system-ui, sans-serif; }
    .sync-pulse { animation: syncPulse 1s infinite; }
    @keyframes syncPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .dark { background: #0f172a; color: #e2e8f0; }
    .dark .bg-white { background: #1e293b !important; }
    .dark .bg-slate-50 { background: #0f172a !important; }
    .dark .bg-gray-50, .dark .bg-gray-100 { background: #334155 !important; }
    .dark .text-gray-900, .dark .text-gray-800, .dark .text-gray-700 { color: #e2e8f0 !important; }
    .dark .text-gray-600, .dark .text-gray-500 { color: #94a3b8 !important; }
    .dark .border { border-color: #475569 !important; }
    .dark input, .dark select { background: #334155 !important; color: #e2e8f0 !important; }
    input::-webkit-inner-spin-button { opacity: 0; }
    input:hover::-webkit-inner-spin-button { opacity: 1; }
    .target-hit { background: #d1fae5 !important; }
    .target-miss { background: #fee2e2 !important; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
<div id="app"></div>
<div id="toast" class="fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 transform translate-y-20 opacity-0 pointer-events-none"><span id="toast-msg"></span></div>

<script>
// JSONBIN CONFIG
const JSONBIN_KEY = '$2a$10$/U.VcMOsSVGv.U3dsQVMCuoT6tCgV8h03geLfIdp0O2S7KE2aleuC';
const STORAGE_KEY = 'salesDash2026_v3';
const BIN_ID_KEY = 'salesDash2026_v3_binId';

let syncStatus = 'idle';
let lastSyncTime = null;
let syncTimeout = null;
let binId = localStorage.getItem(BIN_ID_KEY);

// 2026 KEY DATES
const KEY_DATES = {
  yearStart: '2026-01-02',
  sko: { start: '2026-02-03', end: '2026-02-07', name: 'Sales Kickoff' },
  paternity: { start: '2026-03-03', end: '2026-05-16', name: 'Paternity Leave' },
  pto1: { start: '2026-05-24', end: '2026-05-29', name: 'PTO Week 1' },
  pto2: { start: '2026-10-15', end: '2026-10-19', name: 'PTO Week 2 (TBD)' },
  vendorDeadline: '2026-07-31',
  hardDeadline: '2026-11-30',
  shutdown: { start: '2026-12-08', end: '2026-12-31', name: 'Holiday Shutdown' }
};

// WEEKLY TARGETS
const TARGETS = {
  accounts: 15,  // 10 Monday + 1 each Tue-Fri
  calls: 120,    // 30/day Tue-Fri
  meetings: 5,
  callsPerDay: 30,
  accountsMonday: 10,
  accountsOther: 1
};

// MONTHLY TARGETS (from your plan)
const MONTHLY_PLAN = [
  { month: 'January', deals: 1, revenue: 22000, cumulative: 22000, pct: 6, phase: 'Pipeline Building' },
  { month: 'February', deals: 2, revenue: 37000, cumulative: 59000, pct: 17, phase: 'Accelerate' },
  { month: 'March', deals: 0, revenue: 8000, cumulative: 67000, pct: 19, phase: 'Leave', passive: true },
  { month: 'April', deals: 0, revenue: 8000, cumulative: 75000, pct: 21, phase: 'Leave', passive: true },
  { month: 'May', deals: 0, revenue: 9000, cumulative: 84000, pct: 24, phase: 'Leave', passive: true },
  { month: 'June', deals: 1, revenue: 10000, cumulative: 94000, pct: 27, phase: 'Pipeline Rebuild' },
  { month: 'July', deals: 2, revenue: 40000, cumulative: 134000, pct: 38, phase: 'Vendor Push' },
  { month: 'August', deals: 4, revenue: 74000, cumulative: 208000, pct: 59, phase: 'Acceleration' },
  { month: 'September', deals: 6, revenue: 111000, cumulative: 319000, pct: 91, phase: 'Push for Target' },
  { month: 'October', deals: 4, revenue: 74000, cumulative: 393000, pct: 112, phase: 'Exceed Quota' },
  { month: 'November', deals: 4, revenue: 74000, cumulative: 467000, pct: 133, phase: 'Final Push' },
  { month: 'December', deals: 0, revenue: 0, cumulative: 467000, pct: 133, phase: 'Shutdown' }
];

// DEFAULT SETTINGS
const DEFAULTS = {
  name: 'Stephen Marcotte - 2026',
  quota: 350000,
  targetPct: 110,
  dealSize: 18500,
  closeRate: 24,
  callsPerMeeting: 30,
  totalWeeks: 46,
  ptoWeeks: 13,
  darkMode: false
};

function emptyWeek(num = 1) {
  return {
    num,
    startDate: null,
    mon: { accounts: 0, calls: 0, meetings: 0, pto: false },
    tue: { accounts: 0, calls: 0, meetings: 0, pto: false },
    wed: { accounts: 0, calls: 0, meetings: 0, pto: false },
    thu: { accounts: 0, calls: 0, meetings: 0, pto: false },
    fri: { accounts: 0, calls: 0, meetings: 0, pto: false },
    tasksCompleted: []
  };
}

function emptyData() {
  return {
    settings: { ...DEFAULTS },
    week: emptyWeek(1),
    ytd: { weeks: 0, accounts: 0, calls: 0, meetings: 0, revenue: 0, ptoDays: 0 },
    history: [],
    revenueLog: [],
    todos: []
  };
}

let data = emptyData();
let ui = { tab: 'dash', showSettings: false, loading: true, revenueInput: '', todoInput: '' };

// SYNC FUNCTIONS
async function createBin() {
  try {
    const response = await fetch('https://api.jsonbin.io/v3/b', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY, 'X-Bin-Name': 'sales-dashboard-2026-v3' },
      body: JSON.stringify(data)
    });
    if (!response.ok) throw new Error('Failed');
    const result = await response.json();
    binId = result.metadata.id;
    localStorage.setItem(BIN_ID_KEY, binId);
    return true;
  } catch (err) { console.error(err); return false; }
}

async function loadFromCloud() {
  const local = localStorage.getItem(STORAGE_KEY);
  if (local) {
    try { 
      const parsed = JSON.parse(local);
      if (parsed?.settings) data = { ...emptyData(), ...parsed, settings: { ...DEFAULTS, ...parsed.settings } };
    } catch (e) {}
  }
  ui.loading = false;
  syncStatus = 'syncing';
  render();
  
  if (!binId) {
    const created = await createBin();
    syncStatus = created ? 'synced' : 'error';
    if (created) lastSyncTime = new Date();
    render();
    return;
  }
  
  try {
    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, { headers: { 'X-Master-Key': JSONBIN_KEY } });
    if (!response.ok) throw new Error('Failed');
    const result = await response.json();
    if (result.record?.settings) {
      const cloud = result.record;
      if ((cloud.ytd?.weeks || 0) >= (data.ytd?.weeks || 0) || !local) {
        data = { ...emptyData(), ...cloud, settings: { ...DEFAULTS, ...cloud.settings } };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }
    }
    syncStatus = 'synced';
    lastSyncTime = new Date();
  } catch (err) { syncStatus = 'error'; }
  render();
}

async function saveToCloud() {
  if (!binId) { await createBin(); return; }
  try {
    syncStatus = 'syncing'; render();
    await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY },
      body: JSON.stringify(data)
    });
    syncStatus = 'synced';
    lastSyncTime = new Date();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  } catch (err) { syncStatus = 'error'; localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
  render();
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  if (syncTimeout) clearTimeout(syncTimeout);
  syncStatus = 'syncing'; render();
  syncTimeout = setTimeout(() => saveToCloud(), 2000);
}

function toast(msg, color = 'emerald') {
  const t = document.getElementById('toast');
  t.className = `fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 bg-${color}-600 text-white`;
  document.getElementById('toast-msg').textContent = msg;
  t.classList.remove('translate-y-20', 'opacity-0', 'pointer-events-none');
  setTimeout(() => t.classList.add('translate-y-20', 'opacity-0', 'pointer-events-none'), 2500);
}

// UTILITY FUNCTIONS
function getWorkingWeeks() { return data.settings.totalWeeks - data.settings.ptoWeeks; }
function formatMoney(v) { return v >= 1000000 ? `$${(v/1000000).toFixed(1)}M` : v >= 1000 ? `$${Math.round(v/1000)}K` : `$${v}`; }
function formatMoneyFull(v) { return '$' + v.toLocaleString(); }
function pct(c, t) { return t ? Math.min(c / t * 100, 100).toFixed(0) : 0; }

function targets() {
  const s = data.settings;
  const rev = s.quota * s.targetPct / 100;
  const deals = Math.ceil(rev / s.dealSize);
  const meetings = Math.ceil(deals / (s.closeRate / 100));
  const calls = meetings * s.callsPerMeeting;
  const workWeeks = getWorkingWeeks();
  return { rev, deals, meetings, calls, workWeeks };
}

function weekTotals(week = data.week) {
  const days = ['mon', 'tue', 'wed', 'thu', 'fri'];
  return {
    accounts: days.reduce((s, d) => s + (week[d].pto ? 0 : (week[d].accounts || 0)), 0),
    calls: days.reduce((s, d) => s + (week[d].pto ? 0 : (week[d].calls || 0)), 0),
    meetings: days.reduce((s, d) => s + (week[d].pto ? 0 : (week[d].meetings || 0)), 0),
    ptoDays: days.filter(d => week[d].pto).length
  };
}

function combined() {
  const wk = weekTotals();
  return {
    accounts: data.ytd.accounts + wk.accounts,
    calls: data.ytd.calls + wk.calls,
    meetings: data.ytd.meetings + wk.meetings,
    revenue: data.ytd.revenue
  };
}

function getCurrentPhase() {
  const today = new Date();
  const month = today.getMonth();
  return MONTHLY_PLAN[month]?.phase || 'Unknown';
}

function getDaysUntil(dateStr) {
  const target = new Date(dateStr);
  const today = new Date();
  today.setHours(0,0,0,0);
  target.setHours(0,0,0,0);
  return Math.ceil((target - today) / (1000 * 60 * 60 * 24));
}

function isOnLeave() {
  const today = new Date().toISOString().split('T')[0];
  return today >= KEY_DATES.paternity.start && today <= KEY_DATES.paternity.end;
}

function getCurrentMonth() {
  return new Date().getMonth();
}

function getTodayDay() {
  return ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()];
}

function getMonthlyRevenue() {
  const monthly = {};
  (data.revenueLog || []).forEach(entry => {
    const month = new Date(entry.date).toLocaleString('en-US', { month: 'long' });
    monthly[month] = (monthly[month] || 0) + entry.amount;
  });
  return monthly;
}

// DATA FUNCTIONS
function setDay(day, field, val) {
  if (field === 'pto') data.week[day].pto = val;
  else data.week[day][field] = parseInt(val) || 0;
  save(); render();
}

function setSetting(key, val) {
  data.settings[key] = typeof val === 'string' && !isNaN(val) ? Number(val) : val;
  if (key === 'darkMode') document.documentElement.classList.toggle('dark', val);
  save(); render();
}

function closeWeek() {
  if (!confirm(`Close Week ${data.week.num}?`)) return;
  const t = weekTotals();
  
  // Save to history
  data.history.push({
    num: data.week.num,
    closedDate: new Date().toISOString(),
    accounts: t.accounts,
    calls: t.calls,
    meetings: t.meetings,
    ptoDays: t.ptoDays,
    tasksCompleted: data.week.tasksCompleted || [],
    targetsHit: {
      accounts: t.accounts >= TARGETS.accounts,
      calls: t.calls >= TARGETS.calls,
      meetings: t.meetings >= TARGETS.meetings
    }
  });
  
  // Update YTD
  data.ytd.weeks++;
  data.ytd.accounts += t.accounts;
  data.ytd.calls += t.calls;
  data.ytd.meetings += t.meetings;
  data.ytd.ptoDays += t.ptoDays;
  
  // Clear completed todos and start new week
  data.todos = (data.todos || []).filter(t => !t.done);
  data.week = emptyWeek(data.week.num + 1);
  save();
  toast('‚úì Week closed!');
  render();
}

function addRevenue() {
  const amount = parseFloat(ui.revenueInput);
  if (!amount || amount <= 0) {
    toast('‚ö†Ô∏è Enter a valid amount', 'amber');
    return;
  }
  
  data.revenueLog = data.revenueLog || [];
  data.revenueLog.push({
    amount: amount,
    date: new Date().toISOString(),
    month: new Date().toLocaleString('en-US', { month: 'long', year: 'numeric' })
  });
  
  data.ytd.revenue += amount;
  ui.revenueInput = '';
  save();
  toast(`‚úì Added ${formatMoneyFull(amount)} revenue`);
  render();
}

function addTodo() {
  const text = ui.todoInput.trim();
  if (!text) return;
  
  data.todos = data.todos || [];
  data.todos.push({
    id: Date.now(),
    text: text,
    done: false,
    createdAt: new Date().toISOString()
  });
  
  ui.todoInput = '';
  save();
  render();
}

function toggleTodo(id) {
  data.todos = data.todos || [];
  const todo = data.todos.find(t => t.id === id);
  if (todo) {
    todo.done = !todo.done;
    if (todo.done) {
      todo.completedAt = new Date().toISOString();
      // Track completed task for this week
      data.week.tasksCompleted = data.week.tasksCompleted || [];
      data.week.tasksCompleted.push({
        text: todo.text,
        completedAt: todo.completedAt
      });
    } else {
      // Remove from week's completed if unchecked
      data.week.tasksCompleted = (data.week.tasksCompleted || []).filter(t => t.text !== todo.text);
    }
    save();
    render();
  }
}

function deleteTodo(id) {
  data.todos = data.todos || [];
  data.todos = data.todos.filter(t => t.id !== id);
  save();
  render();
}

function clearCompletedTodos() {
  data.todos = data.todos || [];
  const completed = data.todos.filter(t => t.done).length;
  if (completed === 0) {
    toast('No completed tasks to clear', 'amber');
    return;
  }
  data.todos = data.todos.filter(t => !t.done);
  save();
  toast(`‚úì Cleared ${completed} completed task${completed > 1 ? 's' : ''}`);
  render();
}

// RENDER
function render() {
  if (ui.loading) {
    document.getElementById('app').innerHTML = `<div class="min-h-screen flex items-center justify-center"><div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>`;
    return;
  }

  const T = targets();
  const wk = weekTotals();
  const comb = combined();
  const s = data.settings;
  const phase = getCurrentPhase();
  const deadlineDays = getDaysUntil(KEY_DATES.hardDeadline);
  const onLeave = isOnLeave();
  const currentMonth = getCurrentMonth();
  const td = getTodayDay();
  const dayNames = { mon: 'Monday', tue: 'Tuesday', wed: 'Wednesday', thu: 'Thursday', fri: 'Friday' };
  const monthlyRevenue = getMonthlyRevenue();

  document.documentElement.classList.toggle('dark', s.darkMode);

  const syncColors = { idle: 'bg-gray-400', syncing: 'bg-yellow-400 sync-pulse', synced: 'bg-green-500', error: 'bg-red-500' };
  const syncLabels = { idle: 'Ready', syncing: 'Syncing...', synced: 'Synced', error: 'Local only' };

  document.getElementById('app').innerHTML = `
<div class="max-w-6xl mx-auto p-4 pb-20">
  
  <!-- HEADER -->
  <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 rounded-2xl p-6 mb-6 text-white shadow-lg">
    <div class="flex flex-wrap justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold mb-1">${s.name}</h1>
        <p class="text-blue-100">Week ${data.week.num} ‚Ä¢ ${phase}</p>
        <div class="flex items-center gap-2 text-xs mt-1"><div class="w-2 h-2 rounded-full ${syncColors[syncStatus]}"></div><span class="text-blue-200">${syncLabels[syncStatus]}</span></div>
      </div>
      <div class="text-right">
        <p class="text-3xl font-bold">${formatMoney(comb.revenue)}</p>
        <p class="text-blue-100 text-sm">${(comb.revenue / T.rev * 100).toFixed(0)}% of ${formatMoney(T.rev)} target</p>
        <div class="flex gap-2 mt-2 justify-end">
          <button onclick="ui.showSettings=!ui.showSettings;render()" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">‚öôÔ∏è</button>
          <button onclick="setSetting('darkMode', !data.settings.darkMode)" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">${s.darkMode ? '‚òÄÔ∏è' : 'üåô'}</button>
        </div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mt-4 bg-white/10 rounded-lg p-3">
      <div class="h-3 bg-white/20 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-green-400 to-emerald-400" style="width:${Math.min(comb.revenue / T.rev * 100, 100)}%"></div></div>
      <div class="flex justify-between text-xs text-blue-200 mt-1"><span>${formatMoney(comb.revenue)} closed</span><span>${deadlineDays} days to Nov 30</span></div>
    </div>
    
    <!-- Key Stats Row -->
    <div class="grid grid-cols-4 gap-3 mt-4">
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.accounts}</p><p class="text-xs text-blue-200">Accounts</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.calls.toLocaleString()}</p><p class="text-xs text-blue-200">Calls</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.meetings}</p><p class="text-xs text-blue-200">Meetings</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${data.ytd.weeks}</p><p class="text-xs text-blue-200">Weeks</p></div>
    </div>
  </div>

  ${onLeave ? `<div class="bg-purple-100 border-2 border-purple-300 rounded-xl p-4 mb-6 text-center"><p class="text-purple-800 font-medium">üë∂ You're on paternity leave! Enjoy this time.</p><p class="text-purple-600 text-sm">Returns: May 18, 2026</p></div>` : ''}

  ${ui.showSettings ? `
  <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-blue-200 mb-6">
    <div class="flex justify-between mb-4"><h2 class="font-bold text-lg">‚öôÔ∏è Settings</h2><button onclick="ui.showSettings=false;render()" class="text-2xl text-gray-400">&times;</button></div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div><label class="text-xs text-gray-500">Quota ($)</label><input type="number" value="${s.quota}" onchange="setSetting('quota',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Target %</label><input type="number" value="${s.targetPct}" onchange="setSetting('targetPct',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Avg Deal Size ($)</label><input type="number" value="${s.dealSize}" onchange="setSetting('dealSize',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Close Rate %</label><input type="number" value="${s.closeRate}" onchange="setSetting('closeRate',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Calls/Meeting</label><input type="number" value="${s.callsPerMeeting}" onchange="setSetting('callsPerMeeting',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Total Weeks</label><input type="number" value="${s.totalWeeks}" onchange="setSetting('totalWeeks',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Off Weeks</label><input type="number" value="${s.ptoWeeks}" onchange="setSetting('ptoWeeks',this.value)" class="w-full p-2 border rounded mt-1"></div>
    </div>
    <div class="text-xs text-gray-500 bg-gray-50 p-3 rounded mt-4"><strong>Calculated:</strong> ${getWorkingWeeks()} working weeks ‚Ä¢ Target: ${formatMoney(T.rev)} ‚Ä¢ ${T.deals} deals needed ‚Ä¢ ${T.meetings} meetings needed</div>
  </div>` : ''}

  <!-- TABS -->
  <div class="flex gap-2 mb-6 overflow-x-auto pb-1">
    ${['dash', 'history', 'schedule', 'monthly'].map(tab => `<button onclick="ui.tab='${tab}';render()" class="px-4 py-2 rounded-lg font-medium whitespace-nowrap ${ui.tab === tab ? 'bg-blue-600 text-white shadow' : 'bg-white border hover:bg-gray-50'}">${{ dash: 'üìä Dashboard', history: 'üìú History', schedule: 'üìÖ Schedule', monthly: 'üìà Monthly' }[tab]}</button>`).join('')}
  </div>

  ${ui.tab === 'dash' ? `
  <!-- TO-DO LIST (TOP OF PAGE) -->
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="font-semibold">üìù Today's Tasks</h2>
      <div class="flex items-center gap-3">
        <span class="text-sm text-gray-500">${(data.todos || []).filter(t => t.done).length} of ${(data.todos || []).length} done</span>
        ${(data.todos || []).filter(t => t.done).length > 0 ? `
        <button onclick="clearCompletedTodos()" class="text-xs text-gray-500 hover:text-red-600">Clear completed</button>
        ` : ''}
      </div>
    </div>
    
    <!-- Add Task -->
    <div class="flex gap-2 mb-4">
      <input type="text" value="${ui.todoInput}" oninput="ui.todoInput=this.value" onkeypress="if(event.key==='Enter')addTodo()" placeholder="Add a task..." class="flex-1 p-3 border rounded-lg">
      <button onclick="addTodo()" class="px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">+ Add</button>
    </div>
    
    <!-- Task List -->
    ${(data.todos || []).length > 0 ? `
    <div class="space-y-2">
      ${(data.todos || []).filter(t => !t.done).map(t => `
      <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg group">
        <input type="checkbox" onchange="toggleTodo(${t.id})" class="w-5 h-5 cursor-pointer">
        <span class="flex-1">${t.text}</span>
        <button onclick="deleteTodo(${t.id})" class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">‚úï</button>
      </div>`).join('')}
      
      ${(data.todos || []).filter(t => t.done).length > 0 ? `
      <div class="pt-2 mt-2 border-t">
        <p class="text-xs text-gray-400 mb-2">Completed today</p>
        ${(data.todos || []).filter(t => t.done).map(t => `
        <div class="flex items-center gap-3 p-2 rounded-lg group opacity-50">
          <input type="checkbox" checked onchange="toggleTodo(${t.id})" class="w-5 h-5 cursor-pointer">
          <span class="flex-1 line-through text-gray-500">${t.text}</span>
          <button onclick="deleteTodo(${t.id})" class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">‚úï</button>
        </div>`).join('')}
      </div>` : ''}
    </div>
    ` : `
    <div class="text-center py-6 text-gray-400">
      <p>No tasks yet. Add one above!</p>
    </div>
    `}
  </div>

  <!-- WEEK ENTRY -->
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">Week ${data.week.num} Activity</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="text-gray-500 text-xs border-b">
            <th class="text-left py-2 px-2">Day</th>
            <th class="text-center px-2">PTO</th>
            <th class="text-center px-2">Accounts</th>
            <th class="text-center px-2">Calls</th>
            <th class="text-center px-2">Meetings</th>
          </tr>
        </thead>
        <tbody>
          ${['mon', 'tue', 'wed', 'thu', 'fri'].map(d => {
            const isToday = td === d;
            const dayData = data.week[d];
            const accountTarget = d === 'mon' ? 10 : 1;
            const callTarget = d === 'mon' ? 0 : 30;
            return `
            <tr class="border-b ${isToday ? 'bg-blue-50' : ''} ${dayData.pto ? 'opacity-50' : ''}">
              <td class="py-3 px-2 font-medium ${isToday ? 'text-blue-700' : ''}">${dayNames[d]}${isToday ? ' ‚Ä¢' : ''}</td>
              <td class="text-center px-2"><input type="checkbox" ${dayData.pto ? 'checked' : ''} onchange="setDay('${d}','pto',this.checked)" class="w-4 h-4"></td>
              <td class="text-center px-2"><input type="number" value="${dayData.accounts || ''}" onchange="setDay('${d}','accounts',this.value)" class="w-16 p-1 border rounded text-center ${dayData.accounts >= accountTarget ? 'bg-green-50 border-green-300' : ''}" placeholder="${accountTarget}" ${dayData.pto ? 'disabled' : ''}></td>
              <td class="text-center px-2"><input type="number" value="${dayData.calls || ''}" onchange="setDay('${d}','calls',this.value)" class="w-16 p-1 border rounded text-center ${dayData.calls >= callTarget && callTarget > 0 ? 'bg-green-50 border-green-300' : ''}" placeholder="${callTarget || '‚Äî'}" ${dayData.pto ? 'disabled' : ''}></td>
              <td class="text-center px-2"><input type="number" value="${dayData.meetings || ''}" onchange="setDay('${d}','meetings',this.value)" class="w-16 p-1 border rounded text-center" placeholder="0" ${dayData.pto ? 'disabled' : ''}></td>
            </tr>`;
          }).join('')}
          <tr class="bg-gray-50 font-bold">
            <td class="py-3 px-2" colspan="2">Week Total</td>
            <td class="text-center px-2 ${wk.accounts >= TARGETS.accounts ? 'text-green-600' : 'text-amber-600'}">${wk.accounts}/${TARGETS.accounts}</td>
            <td class="text-center px-2 ${wk.calls >= TARGETS.calls ? 'text-green-600' : 'text-amber-600'}">${wk.calls}/${TARGETS.calls}</td>
            <td class="text-center px-2 ${wk.meetings >= TARGETS.meetings ? 'text-green-600' : 'text-amber-600'}">${wk.meetings}/${TARGETS.meetings}</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Progress Bars -->
    <div class="mt-4 space-y-3">
      <div><div class="flex justify-between text-sm mb-1"><span>Accounts Sequenced</span><span class="${wk.accounts >= TARGETS.accounts ? 'text-green-600 font-bold' : ''}">${wk.accounts}/${TARGETS.accounts}</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.accounts >= TARGETS.accounts ? 'bg-green-500' : 'bg-purple-500'} rounded-full transition-all" style="width:${Math.min(wk.accounts/TARGETS.accounts*100,100)}%"></div></div></div>
      <div><div class="flex justify-between text-sm mb-1"><span>Calls</span><span class="${wk.calls >= TARGETS.calls ? 'text-green-600 font-bold' : ''}">${wk.calls}/${TARGETS.calls}</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.calls >= TARGETS.calls ? 'bg-green-500' : 'bg-blue-500'} rounded-full transition-all" style="width:${Math.min(wk.calls/TARGETS.calls*100,100)}%"></div></div></div>
      <div><div class="flex justify-between text-sm mb-1"><span>Meetings</span><span class="${wk.meetings >= TARGETS.meetings ? 'text-green-600 font-bold' : ''}">${wk.meetings}/${TARGETS.meetings}</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.meetings >= TARGETS.meetings ? 'bg-green-500' : 'bg-green-400'} rounded-full transition-all" style="width:${Math.min(wk.meetings/TARGETS.meetings*100,100)}%"></div></div></div>
    </div>
    
    <div class="mt-4 pt-4 border-t">
      <button onclick="closeWeek()" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">‚úì Close Week ${data.week.num}</button>
    </div>
  </div>

  <!-- REVENUE ENTRY -->
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">üí∞ Log Revenue</h2>
    <div class="flex gap-3 items-end">
      <div class="flex-1">
        <label class="text-xs text-gray-500">Revenue Amount ($)</label>
        <input type="number" value="${ui.revenueInput}" oninput="ui.revenueInput=this.value" onkeypress="if(event.key==='Enter')addRevenue()" placeholder="e.g. 18500" class="w-full p-3 border rounded-lg mt-1 text-lg font-bold">
      </div>
      <button onclick="addRevenue()" class="px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">+ Add Revenue</button>
    </div>
    
    ${data.revenueLog && data.revenueLog.length > 0 ? `
    <div class="mt-4 pt-4 border-t">
      <h3 class="text-sm font-medium text-gray-600 mb-2">Recent Revenue</h3>
      <div class="space-y-2 max-h-40 overflow-y-auto">
        ${data.revenueLog.slice().reverse().slice(0, 5).map(r => `
        <div class="flex justify-between text-sm bg-gray-50 p-2 rounded">
          <span class="text-gray-600">${new Date(r.date).toLocaleDateString()}</span>
          <span class="font-bold text-green-600">${formatMoneyFull(r.amount)}</span>
        </div>`).join('')}
      </div>
    </div>` : ''}
  </div>

  <!-- KEY DATES -->
  <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4 mb-6">
    <h3 class="font-semibold text-amber-800 mb-3">‚ö†Ô∏è Key Dates</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
      <div class="bg-white p-3 rounded-lg"><p class="font-bold text-red-600">${deadlineDays} days</p><p class="text-gray-600">Nov 30 Deadline</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getDaysUntil(KEY_DATES.vendorDeadline)} days</p><p class="text-gray-600">Vendor Deadline</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getDaysUntil(KEY_DATES.paternity.start)} days</p><p class="text-gray-600">Paternity Starts</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getWorkingWeeks() - data.ytd.weeks} wks</p><p class="text-gray-600">Working Weeks Left</p></div>
    </div>
  </div>

  <!-- YTD STATS -->
  <div class="bg-gray-100 rounded-xl p-4">
    <h2 class="font-semibold mb-3">Year-to-Date Totals</h2>
    <div class="grid grid-cols-3 md:grid-cols-5 gap-3 text-center">
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.weeks}</p><p class="text-xs text-gray-500">Weeks</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.accounts}</p><p class="text-xs text-gray-500">Accounts</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.calls.toLocaleString()}</p><p class="text-xs text-gray-500">Calls</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.meetings}</p><p class="text-xs text-gray-500">Meetings</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold text-green-600">${formatMoney(data.ytd.revenue)}</p><p class="text-xs text-gray-500">Revenue</p></div>
    </div>
  </div>
  ` : ''}

  ${ui.tab === 'history' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border">
    <h2 class="font-semibold mb-4">üìú Week History</h2>
    ${data.history && data.history.length > 0 ? `
    <div class="space-y-4">
      ${data.history.slice().reverse().map(w => {
        const allHit = w.targetsHit?.accounts && w.targetsHit?.calls && w.targetsHit?.meetings;
        const someHit = w.targetsHit?.accounts || w.targetsHit?.calls || w.targetsHit?.meetings;
        const tasksCount = (w.tasksCompleted || []).length;
        return `
        <div class="border rounded-lg overflow-hidden ${allHit ? 'border-green-300 bg-green-50' : someHit ? 'border-amber-300 bg-amber-50' : 'border-red-300 bg-red-50'}">
          <!-- Week Header -->
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold text-lg">Week ${w.num}</h3>
              <span class="text-sm px-3 py-1 rounded-full ${allHit ? 'bg-green-200 text-green-800' : someHit ? 'bg-amber-200 text-amber-800' : 'bg-red-200 text-red-800'}">${allHit ? '‚úÖ All Targets Hit' : someHit ? '‚ö†Ô∏è Partial' : '‚ùå Missed'}</span>
            </div>
            
            <!-- Metrics -->
            <div class="grid grid-cols-4 gap-3 text-center text-sm">
              <div class="bg-white/70 p-2 rounded">
                <p class="font-bold ${w.targetsHit?.accounts ? 'text-green-600' : 'text-red-600'}">${w.accounts}/${TARGETS.accounts}</p>
                <p class="text-xs text-gray-600">Accounts</p>
              </div>
              <div class="bg-white/70 p-2 rounded">
                <p class="font-bold ${w.targetsHit?.calls ? 'text-green-600' : 'text-red-600'}">${w.calls}/${TARGETS.calls}</p>
                <p class="text-xs text-gray-600">Calls</p>
              </div>
              <div class="bg-white/70 p-2 rounded">
                <p class="font-bold ${w.targetsHit?.meetings ? 'text-green-600' : 'text-red-600'}">${w.meetings}/${TARGETS.meetings}</p>
                <p class="text-xs text-gray-600">Meetings</p>
              </div>
              <div class="bg-white/70 p-2 rounded">
                <p class="font-bold text-blue-600">${tasksCount}</p>
                <p class="text-xs text-gray-600">Tasks Done</p>
              </div>
            </div>
            
            <!-- Tasks Completed -->
            ${tasksCount > 0 ? `
            <div class="mt-4 pt-3 border-t border-white/50">
              <p class="text-xs font-medium text-gray-600 mb-2">‚úÖ Tasks Completed This Week:</p>
              <div class="flex flex-wrap gap-2">
                ${(w.tasksCompleted || []).map(t => `
                <span class="text-xs bg-white/80 px-2 py-1 rounded text-gray-700">‚úì ${t.text}</span>
                `).join('')}
              </div>
            </div>
            ` : ''}
          </div>
        </div>`;
      }).join('')}
    </div>
    
    <!-- Summary Stats -->
    <div class="mt-6 pt-4 border-t">
      <h3 class="font-medium mb-3">üìä Performance Summary</h3>
      <div class="grid grid-cols-4 gap-4 text-center">
        <div class="bg-green-50 p-3 rounded-lg">
          <p class="text-2xl font-bold text-green-600">${data.history.filter(w => w.targetsHit?.accounts && w.targetsHit?.calls && w.targetsHit?.meetings).length}</p>
          <p class="text-xs text-gray-600">Perfect Weeks</p>
        </div>
        <div class="bg-amber-50 p-3 rounded-lg">
          <p class="text-2xl font-bold text-amber-600">${data.history.filter(w => (w.targetsHit?.accounts || w.targetsHit?.calls || w.targetsHit?.meetings) && !(w.targetsHit?.accounts && w.targetsHit?.calls && w.targetsHit?.meetings)).length}</p>
          <p class="text-xs text-gray-600">Partial Weeks</p>
        </div>
        <div class="bg-red-50 p-3 rounded-lg">
          <p class="text-2xl font-bold text-red-600">${data.history.filter(w => !w.targetsHit?.accounts && !w.targetsHit?.calls && !w.targetsHit?.meetings).length}</p>
          <p class="text-xs text-gray-600">Missed Weeks</p>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-2xl font-bold text-blue-600">${data.history.reduce((s, w) => s + (w.tasksCompleted || []).length, 0)}</p>
          <p class="text-xs text-gray-600">Total Tasks Done</p>
        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-3 gap-4 text-sm">
        <div class="bg-gray-50 p-3 rounded-lg">
          <p class="font-medium">Avg Accounts/Week</p>
          <p class="text-xl font-bold">${data.history.length > 0 ? (data.history.reduce((s,w) => s + w.accounts, 0) / data.history.length).toFixed(1) : '‚Äî'}</p>
        </div>
        <div class="bg-gray-50 p-3 rounded-lg">
          <p class="font-medium">Avg Calls/Week</p>
          <p class="text-xl font-bold">${data.history.length > 0 ? Math.round(data.history.reduce((s,w) => s + w.calls, 0) / data.history.length) : '‚Äî'}</p>
        </div>
        <div class="bg-gray-50 p-3 rounded-lg">
          <p class="font-medium">Avg Meetings/Week</p>
          <p class="text-xl font-bold">${data.history.length > 0 ? (data.history.reduce((s,w) => s + w.meetings, 0) / data.history.length).toFixed(1) : '‚Äî'}</p>
        </div>
      </div>
    </div>
    ` : `
    <div class="text-center py-12 text-gray-500">
      <p class="text-4xl mb-3">üìä</p>
      <p>No weeks closed yet.</p>
      <p class="text-sm">Close your first week to start building your proof!</p>
    </div>
    `}
  </div>
  ` : ''}

  ${ui.tab === 'schedule' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">üìÖ Weekly Schedule Overview</h2>
    <p class="text-gray-600 text-sm mb-6">Block off enough time for calls in your Microsoft calendar. Meetings will vary‚Äîadjust blocks as needed.</p>
    
    <div class="space-y-4">
      <!-- Monday -->
      <div class="border rounded-lg p-4 bg-purple-50">
        <div class="flex justify-between items-center mb-3">
          <h3 class="font-bold text-purple-800">üìö Monday: Research Day</h3>
          <span class="text-sm bg-purple-200 text-purple-800 px-3 py-1 rounded-full">10 accounts</span>
        </div>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <p class="font-medium">Morning (8:30 AM - 12:00 PM)</p>
            <ul class="text-gray-600 mt-1 space-y-1">
              <li>‚Ä¢ Week planning & pipeline review</li>
              <li>‚Ä¢ Research & sequence 5-6 accounts</li>
            </ul>
          </div>
          <div>
            <p class="font-medium">Afternoon (1:30 PM - 5:00 PM)</p>
            <ul class="text-gray-600 mt-1 space-y-1">
              <li>‚Ä¢ Research & sequence 4-5 accounts</li>
              <li>‚Ä¢ QC and start sequences in Outreach</li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- Tue-Fri -->
      <div class="border rounded-lg p-4 bg-blue-50">
        <div class="flex justify-between items-center mb-3">
          <h3 class="font-bold text-blue-800">üìû Tuesday - Friday: Calling Days</h3>
          <span class="text-sm bg-blue-200 text-blue-800 px-3 py-1 rounded-full">30 calls/day ‚Ä¢ 1 account/day</span>
        </div>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <p class="font-medium">Call Blocks Needed (~2.5 hrs total)</p>
            <ul class="text-gray-600 mt-1 space-y-1">
              <li>‚Ä¢ Morning block: ~1.5 hours</li>
              <li>‚Ä¢ Afternoon block: ~1 hour</li>
              <li>‚Ä¢ Flex for meetings as scheduled</li>
            </ul>
          </div>
          <div>
            <p class="font-medium">Daily Targets</p>
            <ul class="text-gray-600 mt-1 space-y-1">
              <li>‚Ä¢ 30 calls from Outreach task list</li>
              <li>‚Ä¢ 1 new account sequenced</li>
              <li>‚Ä¢ 1-2 meetings (varies by day)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Weekly Summary Table -->
    <div class="mt-6">
      <h3 class="font-medium mb-3">Weekly Targets Summary</h3>
      <table class="w-full text-sm">
        <thead>
          <tr class="text-gray-500 border-b">
            <th class="text-left py-2">Day</th>
            <th class="text-center">Accounts</th>
            <th class="text-center">Calls</th>
            <th class="text-center">Meetings</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b"><td class="py-2">Monday</td><td class="text-center font-bold">10</td><td class="text-center text-gray-400">‚Äî</td><td class="text-center text-gray-400">‚Äî</td></tr>
          <tr class="border-b"><td class="py-2">Tuesday</td><td class="text-center">1</td><td class="text-center font-bold">30</td><td class="text-center">1-2</td></tr>
          <tr class="border-b"><td class="py-2">Wednesday</td><td class="text-center">1</td><td class="text-center font-bold">30</td><td class="text-center">1-2</td></tr>
          <tr class="border-b"><td class="py-2">Thursday</td><td class="text-center">1</td><td class="text-center font-bold">30</td><td class="text-center">1-2</td></tr>
          <tr class="border-b"><td class="py-2">Friday</td><td class="text-center">1</td><td class="text-center font-bold">30</td><td class="text-center">1-2</td></tr>
          <tr class="bg-blue-50 font-bold"><td class="py-2">TOTAL</td><td class="text-center">15</td><td class="text-center">120</td><td class="text-center">5</td></tr>
        </tbody>
      </table>
    </div>
    
    <!-- Time Off -->
    <div class="mt-6 pt-4 border-t">
      <h3 class="font-medium mb-3">üìÖ Scheduled Time Off</h3>
      <div class="grid md:grid-cols-2 gap-3">
        <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
          <span class="text-2xl">üë∂</span>
          <div><p class="font-medium">Paternity Leave</p><p class="text-sm text-gray-600">Mar 3 - May 16 (11 weeks)</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
          <span class="text-2xl">üèñÔ∏è</span>
          <div><p class="font-medium">PTO Week 1</p><p class="text-sm text-gray-600">May 24-29</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span class="text-2xl">üèñÔ∏è</span>
          <div><p class="font-medium">PTO Week 2</p><p class="text-sm text-gray-600">Q4 - TBD</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-red-50 rounded-lg">
          <span class="text-2xl">üéÑ</span>
          <div><p class="font-medium">Holiday Shutdown</p><p class="text-sm text-gray-600">Dec 8-31</p></div>
        </div>
      </div>
    </div>
  </div>
  ` : ''}

  ${ui.tab === 'monthly' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">üìà Monthly Plan vs Actual</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead><tr class="text-gray-500 border-b"><th class="text-left py-2">Month</th><th>Phase</th><th>Target</th><th>Actual</th><th>Cumulative</th><th>%</th></tr></thead>
        <tbody>
          ${MONTHLY_PLAN.map((m, i) => {
            const actual = monthlyRevenue[m.month] || 0;
            const isCurrent = i === currentMonth;
            const isPast = i < currentMonth;
            return `
            <tr class="border-b ${isCurrent ? 'bg-blue-50' : ''} ${m.passive ? 'bg-purple-50' : ''} ${m.month === 'December' ? 'bg-gray-100' : ''}">
              <td class="py-2 font-medium ${isCurrent ? 'text-blue-700' : ''}">${m.month}${isCurrent ? ' ‚Ä¢' : ''}</td>
              <td class="text-gray-600 text-xs">${m.phase}</td>
              <td class="font-bold">${formatMoney(m.revenue)}</td>
              <td class="${actual >= m.revenue ? 'text-green-600' : isPast && actual < m.revenue ? 'text-red-600' : ''} font-bold">${actual > 0 ? formatMoney(actual) : '‚Äî'}</td>
              <td>${formatMoney(m.cumulative)}</td>
              <td class="${m.pct >= 100 ? 'text-green-600 font-bold' : ''}">${m.pct}%</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>
    </div>
    
    <div class="mt-6 pt-4 border-t">
      <h3 class="font-medium mb-3">Revenue Log</h3>
      ${data.revenueLog && data.revenueLog.length > 0 ? `
      <div class="space-y-2 max-h-60 overflow-y-auto">
        ${data.revenueLog.slice().reverse().map(r => `
        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
          <div>
            <p class="font-medium">${formatMoneyFull(r.amount)}</p>
            <p class="text-xs text-gray-500">${new Date(r.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>
          </div>
          <span class="text-sm text-gray-500">${r.month}</span>
        </div>`).join('')}
      </div>
      <div class="mt-4 p-3 bg-green-50 rounded-lg flex justify-between items-center">
        <span class="font-medium">Total Revenue</span>
        <span class="text-xl font-bold text-green-600">${formatMoneyFull(data.ytd.revenue)}</span>
      </div>
      ` : `
      <p class="text-gray-500 text-center py-6">No revenue logged yet. Add revenue from the Dashboard tab.</p>
      `}
    </div>
  </div>
  ` : ''}

</div>`;
}

// Init
loadFromCloud();
</script>
</body>
</html>
