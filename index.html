<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Sales Dashboard - Stephen Marcotte</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', system-ui, sans-serif; }
    .sync-pulse { animation: syncPulse 1s infinite; }
    @keyframes syncPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .dark { background: #0f172a; color: #e2e8f0; }
    .dark .bg-white { background: #1e293b !important; }
    .dark .bg-slate-50 { background: #0f172a !important; }
    .dark .bg-gray-50, .dark .bg-gray-100 { background: #334155 !important; }
    .dark .text-gray-900, .dark .text-gray-800, .dark .text-gray-700 { color: #e2e8f0 !important; }
    .dark .text-gray-600, .dark .text-gray-500 { color: #94a3b8 !important; }
    .dark .border { border-color: #475569 !important; }
    .dark input, .dark select { background: #334155 !important; color: #e2e8f0 !important; }
    .phase-current { animation: phasePulse 2s infinite; }
    @keyframes phasePulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); } 50% { box-shadow: 0 0 0 8px rgba(59, 130, 246, 0); } }
    .time-block { transition: all 0.2s; }
    .time-block:hover { transform: scale(1.02); }
    input::-webkit-inner-spin-button { opacity: 0; }
    input:hover::-webkit-inner-spin-button { opacity: 1; }
    .checklist-item { cursor: pointer; transition: all 0.2s; }
    .checklist-item:hover { background: #f3f4f6; }
    .checklist-item.done { opacity: 0.5; text-decoration: line-through; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
<div id="app"></div>
<div id="toast" class="fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 transform translate-y-20 opacity-0 pointer-events-none"><span id="toast-msg"></span></div>

<script>
// JSONBIN CONFIG
const JSONBIN_KEY = '$2a$10$/U.VcMOsSVGv.U3dsQVMCuoT6tCgV8h03geLfIdp0O2S7KE2aleuC';
const STORAGE_KEY = 'salesDash2026_v2';
const BIN_ID_KEY = 'salesDash2026_v2_binId';

let syncStatus = 'idle';
let lastSyncTime = null;
let syncTimeout = null;
let binId = localStorage.getItem(BIN_ID_KEY);

// 2026 KEY DATES
const KEY_DATES = {
  yearStart: '2026-01-02',
  sko: { start: '2026-02-03', end: '2026-02-07', name: 'Sales Kickoff' },
  paternity: { start: '2026-03-03', end: '2026-05-16', name: 'Paternity Leave' },
  pto1: { start: '2026-05-24', end: '2026-05-29', name: 'PTO Week 1' },
  pto2: { start: '2026-10-15', end: '2026-10-19', name: 'PTO Week 2 (TBD)' },
  vendorDeadline: '2026-07-31',
  hardDeadline: '2026-11-30',
  shutdown: { start: '2026-12-08', end: '2026-12-31', name: 'Holiday Shutdown' }
};

// MONTHLY TARGETS (from your plan)
const MONTHLY_PLAN = [
  { month: 'January', deals: 1, revenue: 22000, cumulative: 22000, pct: 6, phase: 'Pipeline Building' },
  { month: 'February', deals: 2, revenue: 37000, cumulative: 59000, pct: 17, phase: 'Accelerate' },
  { month: 'March', deals: 0, revenue: 8000, cumulative: 67000, pct: 19, phase: 'Leave', passive: true },
  { month: 'April', deals: 0, revenue: 8000, cumulative: 75000, pct: 21, phase: 'Leave', passive: true },
  { month: 'May', deals: 0, revenue: 9000, cumulative: 84000, pct: 24, phase: 'Leave', passive: true },
  { month: 'June', deals: 1, revenue: 10000, cumulative: 94000, pct: 27, phase: 'Pipeline Rebuild' },
  { month: 'July', deals: 2, revenue: 40000, cumulative: 134000, pct: 38, phase: 'Vendor Push' },
  { month: 'August', deals: 4, revenue: 74000, cumulative: 208000, pct: 59, phase: 'Acceleration' },
  { month: 'September', deals: 6, revenue: 111000, cumulative: 319000, pct: 91, phase: 'Push for Target' },
  { month: 'October', deals: 4, revenue: 74000, cumulative: 393000, pct: 112, phase: 'Exceed Quota' },
  { month: 'November', deals: 4, revenue: 74000, cumulative: 467000, pct: 133, phase: 'Final Push' },
  { month: 'December', deals: 0, revenue: 0, cumulative: 467000, pct: 133, phase: 'Shutdown' }
];

// DAILY SCHEDULES
const DAILY_SCHEDULES = {
  monday: {
    name: 'Research & Planning',
    emoji: 'ğŸ“š',
    color: 'purple',
    blocks: [
      { time: '8:30-9:00', task: 'Week Planning', type: 'admin', details: 'Review pipeline, prioritize hot deals' },
      { time: '9:00-10:30', task: 'Research Block #1', type: 'research', details: '6 people (2 companies)' },
      { time: '10:30-10:45', task: 'Break', type: 'break' },
      { time: '10:45-12:00', task: 'Research Block #2', type: 'research', details: '6 people (2 companies)' },
      { time: '12:00-1:30', task: 'ğŸ‹ï¸ Lunch + Gym', type: 'lunch' },
      { time: '1:30-3:00', task: 'Research Block #3', type: 'research', details: '6 people (2 companies)' },
      { time: '3:00-3:15', task: 'Break', type: 'break' },
      { time: '3:15-4:30', task: 'Research Block #4', type: 'research', details: '6 people (2 companies)' },
      { time: '4:30-5:00', task: 'Load into Outreach', type: 'admin', details: 'Final QC, start sequences' }
    ],
    output: '24 people researched, 6 companies sequenced',
    callTarget: 0,
    meetingTarget: 0
  },
  tuesday: {
    name: 'Heavy Calling',
    emoji: 'ğŸ“',
    color: 'blue',
    blocks: [
      { time: '8:30-9:00', task: 'Call Prep', type: 'admin', details: 'Review Outreach tasks' },
      { time: '9:00-10:30', task: 'Call Block #1', type: 'calls', details: '20-25 calls' },
      { time: '10:30-10:45', task: 'Break + Notes', type: 'break' },
      { time: '10:45-12:00', task: 'Call Block #2', type: 'calls', details: '15-20 calls' },
      { time: '12:00-1:30', task: 'ğŸ‹ï¸ Lunch + Gym', type: 'lunch' },
      { time: '1:30-2:30', task: 'Discovery Meeting', type: 'meeting', details: '1 meeting' },
      { time: '2:30-2:45', task: 'Meeting Recap', type: 'admin' },
      { time: '2:45-4:00', task: 'Call Block #3', type: 'calls', details: '15-20 calls' },
      { time: '4:00-5:00', task: 'Admin/CRM', type: 'admin', details: 'Update Salesforce' }
    ],
    output: '50-60 calls, 1 discovery meeting',
    callTarget: 55,
    meetingTarget: 1
  },
  wednesday: {
    name: 'Meeting Heavy',
    emoji: 'ğŸ¤',
    color: 'green',
    blocks: [
      { time: '8:30-9:00', task: 'Call Prep', type: 'admin' },
      { time: '9:00-10:30', task: 'Call Block #1', type: 'calls', details: '15-20 calls' },
      { time: '10:30-12:00', task: 'Discovery Meeting', type: 'meeting' },
      { time: '12:00-1:30', task: 'ğŸ‹ï¸ Lunch + Gym', type: 'lunch' },
      { time: '1:30-3:30', task: 'Demo', type: 'meeting', details: 'Full product demo' },
      { time: '3:30-3:45', task: 'Meeting Recap', type: 'admin' },
      { time: '3:45-4:30', task: 'Call Block #2', type: 'calls', details: '15-20 calls' },
      { time: '4:30-5:00', task: 'Admin', type: 'admin', details: 'Meeting recaps' }
    ],
    output: '35-40 calls, 1 discovery, 1 demo',
    callTarget: 38,
    meetingTarget: 2
  },
  thursday: {
    name: 'Balanced',
    emoji: 'âš–ï¸',
    color: 'indigo',
    blocks: [
      { time: '8:30-9:00', task: 'Call Prep', type: 'admin' },
      { time: '9:00-10:30', task: 'Call Block #1', type: 'calls', details: '20-25 calls' },
      { time: '10:30-10:45', task: 'Break + Notes', type: 'break' },
      { time: '10:45-12:00', task: 'Call Block #2', type: 'calls', details: '15-20 calls' },
      { time: '12:00-1:30', task: 'ğŸ‹ï¸ Lunch + Gym', type: 'lunch' },
      { time: '1:30-2:30', task: 'Discovery Meeting', type: 'meeting' },
      { time: '2:30-3:30', task: 'Proposal Writing', type: 'admin', details: '1-2 proposals' },
      { time: '3:30-3:45', task: 'Break', type: 'break' },
      { time: '3:45-5:00', task: 'Call Block #3', type: 'calls', details: '15-20 calls' }
    ],
    output: '50-60 calls, 1 discovery, 1-2 proposals',
    callTarget: 55,
    meetingTarget: 1
  },
  friday: {
    name: 'Closing & Admin',
    emoji: 'ğŸ¯',
    color: 'amber',
    blocks: [
      { time: '8:30-9:00', task: 'Hot Deal Review', type: 'admin' },
      { time: '9:00-10:30', task: 'Follow-up Calls', type: 'calls', details: 'Hot deals, proposals' },
      { time: '10:30-12:00', task: 'Demo', type: 'meeting' },
      { time: '12:00-1:30', task: 'ğŸ‹ï¸ Lunch + Gym', type: 'lunch' },
      { time: '1:30-3:00', task: 'Account Management', type: 'admin', details: 'At-risk only' },
      { time: '3:00-4:00', task: 'Proposals', type: 'admin', details: 'Finish pending' },
      { time: '4:00-5:00', task: 'Week Review', type: 'admin', details: 'Update dashboard, plan Monday' }
    ],
    output: '20-25 calls, 1 demo, week planned',
    callTarget: 22,
    meetingTarget: 1
  }
};

// WEEKLY CHECKLIST TEMPLATE
const WEEKLY_CHECKLIST = {
  monday: ['Review pipeline + hot deals', 'Research Company 1 (6 people)', 'Research Company 2 (6 people)', 'Research Company 3 (6 people)', 'Research Company 4 (6 people)', 'Load all into Outreach', 'Plan Tuesday blocks'],
  tuesday: ['Review Outreach tasks', 'Call Block #1 (20-25)', 'Call Block #2 (15-20)', 'Discovery Meeting', 'Call Block #3 (15-20)', 'Update Salesforce'],
  wednesday: ['Call Block #1 (15-20)', 'Discovery Meeting', 'Demo', 'Call Block #2 (15-20)', 'Meeting recaps'],
  thursday: ['Call Block #1 (20-25)', 'Call Block #2 (15-20)', 'Discovery Meeting', 'Write 1-2 proposals', 'Call Block #3 (15-20)'],
  friday: ['Follow-up calls', 'Demo', 'Account management', 'Finish proposals', 'Week review in dashboard', 'Plan Monday research']
};

// DEFAULT SETTINGS
const DEFAULTS = {
  name: 'Stephen Marcotte - 2026',
  quota: 350000,
  targetPct: 110,
  dealSize: 18500,
  closeRate: 24,
  callsPerAppt: 30,
  totalWeeks: 46,
  ptoWeeks: 13,
  callDaysPerWeek: 4,
  acctsPerMonday: 24,
  darkMode: false
};

function emptyWeek(num = 1) {
  return {
    num,
    mon: { people: 0, companies: 0, pto: false },
    tue: { calls: 0, meetings: 0, pto: false },
    wed: { calls: 0, meetings: 0, pto: false },
    thu: { calls: 0, meetings: 0, pto: false },
    fri: { calls: 0, meetings: 0, pto: false },
    checklist: { monday: [], tuesday: [], wednesday: [], thursday: [], friday: [] }
  };
}

function emptyData() {
  return {
    settings: { ...DEFAULTS },
    week: emptyWeek(1),
    ytd: { weeks: 0, people: 0, companies: 0, calls: 0, meetings: 0, demos: 0, proposals: 0, deals: 0, rev: 0, ptoDays: 0 },
    deals: [],
    monthlyActual: {},
    productMix: { fuel: 0, vendor: 0, combo: 0 },
    streak: { current: 0, best: 0, lastDate: null }
  };
}

let data = emptyData();
let ui = { tab: 'dash', showSettings: false, loading: true, scheduleDay: null };

// SYNC FUNCTIONS
async function createBin() {
  try {
    const response = await fetch('https://api.jsonbin.io/v3/b', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY, 'X-Bin-Name': 'sales-dashboard-2026-v2' },
      body: JSON.stringify(data)
    });
    if (!response.ok) throw new Error('Failed');
    const result = await response.json();
    binId = result.metadata.id;
    localStorage.setItem(BIN_ID_KEY, binId);
    return true;
  } catch (err) { console.error(err); return false; }
}

async function loadFromCloud() {
  const local = localStorage.getItem(STORAGE_KEY);
  if (local) {
    try { 
      const parsed = JSON.parse(local);
      if (parsed?.settings) data = { ...emptyData(), ...parsed, settings: { ...DEFAULTS, ...parsed.settings } };
    } catch (e) {}
  }
  ui.loading = false;
  syncStatus = 'syncing';
  render();
  
  if (!binId) {
    const created = await createBin();
    syncStatus = created ? 'synced' : 'error';
    if (created) lastSyncTime = new Date();
    render();
    return;
  }
  
  try {
    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, { headers: { 'X-Master-Key': JSONBIN_KEY } });
    if (!response.ok) throw new Error('Failed');
    const result = await response.json();
    if (result.record?.settings) {
      const cloud = result.record;
      if ((cloud.ytd?.weeks || 0) >= (data.ytd?.weeks || 0) || !local) {
        data = { ...emptyData(), ...cloud, settings: { ...DEFAULTS, ...cloud.settings } };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }
    }
    syncStatus = 'synced';
    lastSyncTime = new Date();
  } catch (err) { syncStatus = 'error'; }
  render();
}

async function saveToCloud() {
  if (!binId) { await createBin(); return; }
  try {
    syncStatus = 'syncing'; render();
    await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY },
      body: JSON.stringify(data)
    });
    syncStatus = 'synced';
    lastSyncTime = new Date();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  } catch (err) { syncStatus = 'error'; localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
  render();
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  if (syncTimeout) clearTimeout(syncTimeout);
  syncStatus = 'syncing'; render();
  syncTimeout = setTimeout(() => saveToCloud(), 2000);
}

function toast(msg, color = 'emerald') {
  const t = document.getElementById('toast');
  t.className = `fixed bottom-5 right-5 px-4 py-3 rounded-lg shadow-xl z-50 transition-all duration-300 bg-${color}-600 text-white`;
  document.getElementById('toast-msg').textContent = msg;
  t.classList.remove('translate-y-20', 'opacity-0', 'pointer-events-none');
  setTimeout(() => t.classList.add('translate-y-20', 'opacity-0', 'pointer-events-none'), 2500);
}

// UTILITY FUNCTIONS
function getWorkingWeeks() { return data.settings.totalWeeks - data.settings.ptoWeeks; }
function formatMoney(v) { return v >= 1000000 ? `$${(v/1000000).toFixed(1)}M` : v >= 1000 ? `$${(v/1000).toFixed(0)}K` : `$${v}`; }
function pct(c, t) { return t ? Math.min(c / t * 100, 100).toFixed(0) : 0; }

function targets() {
  const s = data.settings;
  const rev = s.quota * s.targetPct / 100;
  const deals = Math.ceil(rev / s.dealSize);
  const meetings = Math.ceil(deals / (s.closeRate / 100));
  const calls = meetings * s.callsPerAppt;
  const workWeeks = getWorkingWeeks();
  return {
    rev, deals, meetings, calls,
    wk: { calls: Math.ceil(calls / workWeeks), meetings: Math.ceil(meetings / workWeeks), people: s.acctsPerMonday, companies: Math.ceil(s.acctsPerMonday / 4) }
  };
}

function weekTotals() {
  const w = data.week;
  return {
    people: w.mon.pto ? 0 : w.mon.people,
    companies: w.mon.pto ? 0 : w.mon.companies,
    calls: ['tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].calls), 0),
    meetings: ['tue','wed','thu','fri'].reduce((s, d) => s + (w[d].pto ? 0 : w[d].meetings), 0),
    ptoDays: ['mon','tue','wed','thu','fri'].filter(d => w[d].pto).length
  };
}

function combined() {
  const wk = weekTotals();
  return {
    people: data.ytd.people + wk.people,
    companies: data.ytd.companies + wk.companies,
    calls: data.ytd.calls + wk.calls,
    meetings: data.ytd.meetings + wk.meetings,
    deals: data.ytd.deals,
    rev: data.ytd.rev
  };
}

function getCurrentPhase() {
  const today = new Date();
  const month = today.getMonth();
  return MONTHLY_PLAN[month]?.phase || 'Unknown';
}

function getDaysUntil(dateStr) {
  const target = new Date(dateStr);
  const today = new Date();
  today.setHours(0,0,0,0);
  target.setHours(0,0,0,0);
  return Math.ceil((target - today) / (1000 * 60 * 60 * 24));
}

function isOnLeave() {
  const today = new Date().toISOString().split('T')[0];
  return today >= KEY_DATES.paternity.start && today <= KEY_DATES.paternity.end;
}

function getCurrentMonth() {
  return new Date().getMonth();
}

function getTodayDay() {
  return ['sun','mon','tue','wed','thu','fri','sat'][new Date().getDay()];
}

// DATA FUNCTIONS
function setDay(day, field, val) {
  if (field === 'pto') data.week[day].pto = val;
  else data.week[day][field] = parseInt(val) || 0;
  save(); render();
}

function setSetting(key, val) {
  data.settings[key] = typeof val === 'string' && !isNaN(val) ? Number(val) : val;
  if (key === 'darkMode') document.documentElement.classList.toggle('dark', val);
  save(); render();
}

function closeWeek() {
  if (!confirm(`Close Week ${data.week.num}?`)) return;
  const t = weekTotals();
  data.ytd.weeks++;
  data.ytd.people += t.people;
  data.ytd.companies += t.companies;
  data.ytd.calls += t.calls;
  data.ytd.meetings += t.meetings;
  data.ytd.ptoDays += t.ptoDays;
  data.week = emptyWeek(data.week.num + 1);
  save();
  toast('âœ“ Week closed!');
  render();
}

function addDeal(type = 'fuel') {
  const amounts = { fuel: 18500, vendor: 22000, combo: 15000 };
  const amt = amounts[type] || 18500;
  data.ytd.deals++;
  data.ytd.rev += amt;
  data.productMix[type] = (data.productMix[type] || 0) + 1;
  const month = new Date().toLocaleString('en-US', { month: 'long' });
  data.monthlyActual[month] = (data.monthlyActual[month] || 0) + amt;
  data.deals.push({ amount: amt, type, date: new Date().toISOString() });
  save();
  toast(`âœ“ ${type.charAt(0).toUpperCase() + type.slice(1)} deal: ${formatMoney(amt)}`);
  render();
}

function toggleChecklist(day, idx) {
  if (!data.week.checklist) data.week.checklist = { monday: [], tuesday: [], wednesday: [], thursday: [], friday: [] };
  if (!data.week.checklist[day]) data.week.checklist[day] = [];
  const i = data.week.checklist[day].indexOf(idx);
  if (i >= 0) data.week.checklist[day].splice(i, 1);
  else data.week.checklist[day].push(idx);
  save(); render();
}

function quickLog(type) {
  const td = getTodayDay();
  if (td === 'sun' || td === 'sat') { toast('âš ï¸ Weekend!', 'amber'); return; }
  const sched = DAILY_SCHEDULES[td === 'mon' ? 'monday' : td === 'tue' ? 'tuesday' : td === 'wed' ? 'wednesday' : td === 'thu' ? 'thursday' : 'friday'];
  if (type === 'good') {
    if (td === 'mon') { data.week.mon.people = 24; data.week.mon.companies = 6; }
    else { data.week[td].calls = sched.callTarget; data.week[td].meetings = sched.meetingTarget; }
  } else if (type === 'light') {
    if (td === 'mon') { data.week.mon.people = 12; data.week.mon.companies = 3; }
    else { data.week[td].calls = Math.ceil(sched.callTarget / 2); }
  } else if (type === 'pto') {
    data.week[td].pto = true;
  }
  save(); toast(`âœ“ ${type} day logged`); render();
}

// RENDER
function render() {
  if (ui.loading) {
    document.getElementById('app').innerHTML = `<div class="min-h-screen flex items-center justify-center"><div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>`;
    return;
  }

  const T = targets();
  const wk = weekTotals();
  const comb = combined();
  const s = data.settings;
  const phase = getCurrentPhase();
  const deadlineDays = getDaysUntil(KEY_DATES.hardDeadline);
  const onLeave = isOnLeave();
  const currentMonth = getCurrentMonth();
  const td = getTodayDay();
  const isWeekday = td !== 'sun' && td !== 'sat';
  const dayNames = { mon: 'Monday', tue: 'Tuesday', wed: 'Wednesday', thu: 'Thursday', fri: 'Friday' };
  const schedKey = td === 'mon' ? 'monday' : td === 'tue' ? 'tuesday' : td === 'wed' ? 'wednesday' : td === 'thu' ? 'thursday' : td === 'fri' ? 'friday' : null;

  document.documentElement.classList.toggle('dark', s.darkMode);

  const syncColors = { idle: 'bg-gray-400', syncing: 'bg-yellow-400 sync-pulse', synced: 'bg-green-500', error: 'bg-red-500' };
  const syncLabels = { idle: 'Ready', syncing: 'Syncing...', synced: lastSyncTime ? `Synced` : 'Synced', error: 'Local only' };

  document.getElementById('app').innerHTML = `
<div class="max-w-6xl mx-auto p-4 pb-20">
  
  <!-- HEADER -->
  <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 rounded-2xl p-6 mb-6 text-white shadow-lg">
    <div class="flex flex-wrap justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold mb-1">${s.name}</h1>
        <p class="text-blue-100">Week ${data.week.num} â€¢ ${phase}</p>
        <div class="flex items-center gap-2 text-xs mt-1"><div class="w-2 h-2 rounded-full ${syncColors[syncStatus]}"></div><span class="text-blue-200">${syncLabels[syncStatus]}</span></div>
      </div>
      <div class="text-right">
        <p class="text-3xl font-bold">${formatMoney(comb.rev)}</p>
        <p class="text-blue-100 text-sm">${(comb.rev / T.rev * 100).toFixed(0)}% of ${formatMoney(T.rev)}</p>
        <div class="flex gap-2 mt-2 justify-end">
          <button onclick="ui.showSettings=!ui.showSettings;render()" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">âš™ï¸</button>
          <button onclick="setSetting('darkMode', !data.settings.darkMode)" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30">${s.darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</button>
        </div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mt-4 bg-white/10 rounded-lg p-3">
      <div class="h-3 bg-white/20 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-green-400 to-emerald-400" style="width:${Math.min(comb.rev / T.rev * 100, 100)}%"></div></div>
      <div class="flex justify-between text-xs text-blue-200 mt-1"><span>${comb.deals} deals (${T.deals - comb.deals} to go)</span><span>Deadline: ${deadlineDays} days</span></div>
    </div>
    
    <!-- Key Stats Row -->
    <div class="grid grid-cols-4 gap-3 mt-4">
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.calls.toLocaleString()}</p><p class="text-xs text-blue-200">Calls</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.meetings}</p><p class="text-xs text-blue-200">Meetings</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.companies}</p><p class="text-xs text-blue-200">Companies</p></div>
      <div class="bg-white/10 rounded-lg p-2 text-center"><p class="text-xl font-bold">${comb.deals}</p><p class="text-xs text-blue-200">Deals</p></div>
    </div>
  </div>

  ${onLeave ? `<div class="bg-purple-100 border-2 border-purple-300 rounded-xl p-4 mb-6 text-center"><p class="text-purple-800 font-medium">ğŸ‘¶ You're on paternity leave! Enjoy this time.</p><p class="text-purple-600 text-sm">Returns: May 18, 2026</p></div>` : ''}

  ${ui.showSettings ? `
  <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-blue-200 mb-6">
    <div class="flex justify-between mb-4"><h2 class="font-bold text-lg">âš™ï¸ Settings</h2><button onclick="ui.showSettings=false;render()" class="text-2xl text-gray-400">&times;</button></div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div><label class="text-xs text-gray-500">Quota ($)</label><input type="number" value="${s.quota}" onchange="setSetting('quota',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Target %</label><input type="number" value="${s.targetPct}" onchange="setSetting('targetPct',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Deal Size ($)</label><input type="number" value="${s.dealSize}" onchange="setSetting('dealSize',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Close Rate %</label><input type="number" value="${s.closeRate}" onchange="setSetting('closeRate',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Calls/Meeting</label><input type="number" value="${s.callsPerAppt}" onchange="setSetting('callsPerAppt',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">People/Monday</label><input type="number" value="${s.acctsPerMonday}" onchange="setSetting('acctsPerMonday',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Total Weeks</label><input type="number" value="${s.totalWeeks}" onchange="setSetting('totalWeeks',this.value)" class="w-full p-2 border rounded mt-1"></div>
      <div><label class="text-xs text-gray-500">Off Weeks</label><input type="number" value="${s.ptoWeeks}" onchange="setSetting('ptoWeeks',this.value)" class="w-full p-2 border rounded mt-1"></div>
    </div>
    <div class="text-xs text-gray-500 bg-gray-50 p-3 rounded mt-4"><strong>Calculated:</strong> ${getWorkingWeeks()} working weeks â†’ ${T.deals} deals â†’ ${T.meetings} meetings â†’ ${T.calls.toLocaleString()} calls</div>
  </div>` : ''}

  <!-- TABS -->
  <div class="flex gap-2 mb-6 overflow-x-auto pb-1">
    ${['dash', 'schedule', 'monthly', 'checklist'].map(tab => `<button onclick="ui.tab='${tab}';render()" class="px-4 py-2 rounded-lg font-medium whitespace-nowrap ${ui.tab === tab ? 'bg-blue-600 text-white shadow' : 'bg-white border hover:bg-gray-50'}">${{ dash: 'ğŸ“Š Dashboard', schedule: 'ğŸ“… Schedule', monthly: 'ğŸ“ˆ Monthly', checklist: 'â˜‘ï¸ Checklist' }[tab]}</button>`).join('')}
  </div>

  ${ui.tab === 'dash' ? `
  <!-- QUICK LOG -->
  ${isWeekday ? `<div class="bg-white rounded-xl p-4 shadow-sm border mb-6"><div class="flex flex-wrap items-center gap-3"><span class="font-medium">Quick Log (${dayNames[td]}):</span><button onclick="quickLog('good')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium">âœ“ Good Day</button><button onclick="quickLog('light')" class="px-4 py-2 bg-amber-500 text-white rounded-lg font-medium">Â½ Light</button><button onclick="quickLog('pto')" class="px-4 py-2 bg-gray-500 text-white rounded-lg font-medium">ğŸ–ï¸ PTO</button></div></div>` : ''}

  <!-- WEEK ENTRY -->
  <div class="grid md:grid-cols-2 gap-6 mb-6">
    <div class="bg-white rounded-xl p-4 shadow-sm border">
      <h2 class="font-semibold mb-4">Week ${data.week.num} Activity</h2>
      <table class="w-full text-sm">
        <thead><tr class="text-gray-500 text-xs"><th class="text-left py-2">Day</th><th>PTO</th><th>People/Calls</th><th>Meetings</th></tr></thead>
        <tbody>
          <tr class="border-t ${td === 'mon' ? 'bg-blue-50' : ''} ${data.week.mon.pto ? 'opacity-50' : ''}">
            <td class="py-2 font-medium">Mon (Research)</td>
            <td class="text-center"><input type="checkbox" ${data.week.mon.pto ? 'checked' : ''} onchange="setDay('mon','pto',this.checked)" class="w-4 h-4"></td>
            <td class="text-center"><input type="number" value="${data.week.mon.people || ''}" onchange="setDay('mon','people',this.value)" class="w-14 p-1 border rounded text-center" placeholder="24"></td>
            <td class="text-center text-gray-400">â€”</td>
          </tr>
          ${['tue','wed','thu','fri'].map(d => `
          <tr class="border-t ${td === d ? 'bg-blue-50' : ''} ${data.week[d].pto ? 'opacity-50' : ''}">
            <td class="py-2 font-medium">${dayNames[d].slice(0,3)}</td>
            <td class="text-center"><input type="checkbox" ${data.week[d].pto ? 'checked' : ''} onchange="setDay('${d}','pto',this.checked)" class="w-4 h-4"></td>
            <td class="text-center"><input type="number" value="${data.week[d].calls || ''}" onchange="setDay('${d}','calls',this.value)" class="w-14 p-1 border rounded text-center" placeholder="${DAILY_SCHEDULES[d === 'tue' ? 'tuesday' : d === 'wed' ? 'wednesday' : d === 'thu' ? 'thursday' : 'friday'].callTarget}"></td>
            <td class="text-center"><input type="number" value="${data.week[d].meetings || ''}" onchange="setDay('${d}','meetings',this.value)" class="w-14 p-1 border rounded text-center" placeholder="${DAILY_SCHEDULES[d === 'tue' ? 'tuesday' : d === 'wed' ? 'wednesday' : d === 'thu' ? 'thursday' : 'friday'].meetingTarget}"></td>
          </tr>`).join('')}
          <tr class="border-t-2 font-bold bg-gray-50">
            <td class="py-2" colspan="2">Total</td>
            <td class="text-center">${wk.people || wk.calls}</td>
            <td class="text-center">${wk.meetings}</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="bg-white rounded-xl p-4 shadow-sm border">
      <h2 class="font-semibold mb-4">Week ${data.week.num} Targets</h2>
      <div class="space-y-3">
        <div><div class="flex justify-between text-sm mb-1"><span>Calls</span><span class="${wk.calls >= 130 ? 'text-green-600 font-bold' : ''}">${wk.calls}/130-150</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.calls >= 130 ? 'bg-green-500' : 'bg-blue-500'} rounded-full" style="width:${Math.min(wk.calls/150*100,100)}%"></div></div></div>
        <div><div class="flex justify-between text-sm mb-1"><span>Meetings</span><span class="${wk.meetings >= 5 ? 'text-green-600 font-bold' : ''}">${wk.meetings}/5</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.meetings >= 5 ? 'bg-green-500' : 'bg-green-400'} rounded-full" style="width:${Math.min(wk.meetings/5*100,100)}%"></div></div></div>
        <div><div class="flex justify-between text-sm mb-1"><span>People Researched</span><span class="${wk.people >= 24 ? 'text-green-600 font-bold' : ''}">${wk.people}/24</span></div><div class="h-2 bg-gray-200 rounded-full"><div class="h-full ${wk.people >= 24 ? 'bg-green-500' : 'bg-purple-500'} rounded-full" style="width:${Math.min(wk.people/24*100,100)}%"></div></div></div>
      </div>
      
      <div class="mt-4 pt-4 border-t">
        <button onclick="closeWeek()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">âœ“ Close Week ${data.week.num}</button>
      </div>
    </div>
  </div>

  <!-- DEALS -->
  <div class="bg-white rounded-xl p-4 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">ğŸ‰ Log Deal</h2>
    <div class="flex flex-wrap gap-3">
      <button onclick="addDeal('fuel')" class="px-5 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
        <span class="block text-lg">â›½ Fuel Deal</span>
        <span class="text-sm opacity-80">$18,500</span>
      </button>
      <button onclick="addDeal('vendor')" class="px-5 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700">
        <span class="block text-lg">ğŸ’³ Vendor Deal</span>
        <span class="text-sm opacity-80">$22,000</span>
      </button>
      <button onclick="addDeal('combo')" class="px-5 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">
        <span class="block text-lg">ğŸ“¦ Combo Deal</span>
        <span class="text-sm opacity-80">$15,000</span>
      </button>
    </div>
    <div class="mt-4 grid grid-cols-3 gap-3 text-center text-sm">
      <div class="bg-blue-50 p-2 rounded"><span class="font-bold">${data.productMix?.fuel || 0}</span> Fuel</div>
      <div class="bg-purple-50 p-2 rounded"><span class="font-bold">${data.productMix?.vendor || 0}</span> Vendor</div>
      <div class="bg-green-50 p-2 rounded"><span class="font-bold">${data.productMix?.combo || 0}</span> Combo</div>
    </div>
  </div>

  <!-- KEY DATES -->
  <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4 mb-6">
    <h3 class="font-semibold text-amber-800 mb-3">âš ï¸ Key Dates</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
      <div class="bg-white p-3 rounded-lg"><p class="font-bold text-red-600">${deadlineDays} days</p><p class="text-gray-600">Nov 30 Deadline</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getDaysUntil(KEY_DATES.vendorDeadline)} days</p><p class="text-gray-600">Vendor Deadline</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getDaysUntil(KEY_DATES.paternity.start)} days</p><p class="text-gray-600">Paternity Starts</p></div>
      <div class="bg-white p-3 rounded-lg"><p class="font-bold">${getWorkingWeeks() - data.ytd.weeks} wks</p><p class="text-gray-600">Working Weeks Left</p></div>
    </div>
  </div>

  <!-- YTD STATS -->
  <div class="bg-gray-100 rounded-xl p-4">
    <h2 class="font-semibold mb-3">Year-to-Date</h2>
    <div class="grid grid-cols-3 md:grid-cols-6 gap-3 text-center">
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.weeks}</p><p class="text-xs text-gray-500">Weeks</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.calls.toLocaleString()}</p><p class="text-xs text-gray-500">Calls</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.meetings}</p><p class="text-xs text-gray-500">Meetings</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold">${data.ytd.companies}</p><p class="text-xs text-gray-500">Companies</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold text-green-600">${data.ytd.deals}</p><p class="text-xs text-gray-500">Deals</p></div>
      <div class="bg-white rounded-lg p-3"><p class="text-xl font-bold text-green-600">${formatMoney(data.ytd.rev)}</p><p class="text-xs text-gray-500">Revenue</p></div>
    </div>
  </div>
  ` : ''}

  ${ui.tab === 'schedule' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">ğŸ“… Daily Schedules</h2>
    <div class="flex gap-2 mb-6 overflow-x-auto">
      ${Object.entries(DAILY_SCHEDULES).map(([key, day]) => `<button onclick="ui.scheduleDay='${key}';render()" class="px-4 py-2 rounded-lg font-medium whitespace-nowrap ${ui.scheduleDay === key ? `bg-${day.color}-600 text-white` : 'bg-gray-100 hover:bg-gray-200'}">${day.emoji} ${key.charAt(0).toUpperCase() + key.slice(1)}</button>`).join('')}
    </div>
    
    ${ui.scheduleDay ? (() => {
      const day = DAILY_SCHEDULES[ui.scheduleDay];
      const typeColors = { research: 'bg-purple-100 border-purple-300', calls: 'bg-blue-100 border-blue-300', meeting: 'bg-green-100 border-green-300', admin: 'bg-gray-100 border-gray-300', lunch: 'bg-amber-100 border-amber-300', break: 'bg-gray-50 border-gray-200' };
      return `
      <div class="mb-4">
        <h3 class="text-xl font-bold text-${day.color}-600">${day.emoji} ${day.name}</h3>
        <p class="text-gray-500 text-sm">Target: ${day.output}</p>
      </div>
      <div class="space-y-2">
        ${day.blocks.map(b => `
        <div class="time-block flex items-center gap-4 p-3 rounded-lg border ${typeColors[b.type]}">
          <span class="font-mono text-sm font-bold w-24 text-gray-600">${b.time}</span>
          <div class="flex-1">
            <p class="font-medium">${b.task}</p>
            ${b.details ? `<p class="text-sm text-gray-600">${b.details}</p>` : ''}
          </div>
        </div>`).join('')}
      </div>
      <div class="mt-4 p-4 bg-${day.color}-50 rounded-lg">
        <p class="font-semibold text-${day.color}-800">ğŸ“¦ Daily Output: ${day.output}</p>
      </div>`;
    })() : '<p class="text-gray-500 text-center py-8">Select a day above to view the schedule</p>'}
  </div>
  
  <div class="bg-white rounded-xl p-6 shadow-sm border">
    <h2 class="font-semibold mb-4">ğŸ“Š Weekly Summary</h2>
    <table class="w-full text-sm">
      <thead><tr class="text-gray-500 border-b"><th class="text-left py-2">Day</th><th>Focus</th><th>Calls</th><th>Meetings</th></tr></thead>
      <tbody>
        ${Object.entries(DAILY_SCHEDULES).map(([key, day]) => `
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2 font-medium">${day.emoji} ${key.charAt(0).toUpperCase() + key.slice(1)}</td>
          <td class="text-gray-600">${day.name}</td>
          <td class="text-center font-bold">${day.callTarget}</td>
          <td class="text-center font-bold">${day.meetingTarget}</td>
        </tr>`).join('')}
        <tr class="bg-blue-50 font-bold">
          <td class="py-2" colspan="2">WEEKLY TOTAL</td>
          <td class="text-center">155-185</td>
          <td class="text-center">5</td>
        </tr>
      </tbody>
    </table>
  </div>
  ` : ''}

  ${ui.tab === 'monthly' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border mb-6">
    <h2 class="font-semibold mb-4">ğŸ“ˆ Monthly Plan vs Actual</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead><tr class="text-gray-500 border-b"><th class="text-left py-2">Month</th><th>Phase</th><th>Target</th><th>Actual</th><th>Cumulative</th><th>%</th></tr></thead>
        <tbody>
          ${MONTHLY_PLAN.map((m, i) => {
            const actual = data.monthlyActual?.[m.month] || 0;
            const isCurrent = i === currentMonth;
            const isPast = i < currentMonth;
            return `
            <tr class="border-b ${isCurrent ? 'bg-blue-50 phase-current' : ''} ${m.passive ? 'bg-purple-50' : ''} ${m.month === 'December' ? 'bg-gray-100' : ''}">
              <td class="py-2 font-medium">${m.month}</td>
              <td class="text-gray-600 text-xs">${m.phase}</td>
              <td class="font-bold">${formatMoney(m.revenue)}</td>
              <td class="${actual >= m.revenue ? 'text-green-600' : isPast ? 'text-red-600' : ''} font-bold">${actual > 0 ? formatMoney(actual) : 'â€”'}</td>
              <td>${formatMoney(m.cumulative)}</td>
              <td class="${m.pct >= 100 ? 'text-green-600 font-bold' : ''}">${m.pct}%</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>
    </div>
  </div>
  
  <div class="grid md:grid-cols-2 gap-6">
    <div class="bg-white rounded-xl p-6 shadow-sm border">
      <h2 class="font-semibold mb-4">ğŸ¯ Product Mix Target</h2>
      <div class="space-y-4">
        <div><div class="flex justify-between mb-1"><span>â›½ Fuel (17 deals)</span><span class="font-bold">${data.productMix?.fuel || 0}/17</span></div><div class="h-3 bg-gray-200 rounded-full"><div class="h-full bg-blue-500 rounded-full" style="width:${Math.min((data.productMix?.fuel || 0)/17*100,100)}%"></div></div></div>
        <div><div class="flex justify-between mb-1"><span>ğŸ’³ Vendor (3 deals)</span><span class="font-bold">${data.productMix?.vendor || 0}/3</span></div><div class="h-3 bg-gray-200 rounded-full"><div class="h-full bg-purple-500 rounded-full" style="width:${Math.min((data.productMix?.vendor || 0)/3*100,100)}%"></div></div></div>
        <div><div class="flex justify-between mb-1"><span>ğŸ“¦ Combo (1 deal)</span><span class="font-bold">${data.productMix?.combo || 0}/1</span></div><div class="h-3 bg-gray-200 rounded-full"><div class="h-full bg-green-500 rounded-full" style="width:${Math.min((data.productMix?.combo || 0)/1*100,100)}%"></div></div></div>
      </div>
      <p class="text-xs text-amber-600 mt-4 bg-amber-50 p-2 rounded">âš ï¸ Vendor deals must close by July 31!</p>
    </div>
    
    <div class="bg-white rounded-xl p-6 shadow-sm border">
      <h2 class="font-semibold mb-4">ğŸ“… Time Off Calendar</h2>
      <div class="space-y-3">
        <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
          <span class="text-2xl">ğŸ‘¶</span>
          <div><p class="font-medium">Paternity Leave</p><p class="text-sm text-gray-600">Mar 3 - May 16 (11 weeks)</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
          <span class="text-2xl">ğŸ–ï¸</span>
          <div><p class="font-medium">PTO Week 1</p><p class="text-sm text-gray-600">May 24-29</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span class="text-2xl">ğŸ–ï¸</span>
          <div><p class="font-medium">PTO Week 2 (TBD)</p><p class="text-sm text-gray-600">Q4 - Date TBD</p></div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-red-50 rounded-lg">
          <span class="text-2xl">ğŸ„</span>
          <div><p class="font-medium">Holiday Shutdown</p><p class="text-sm text-gray-600">Dec 8-31</p></div>
        </div>
      </div>
    </div>
  </div>
  ` : ''}

  ${ui.tab === 'checklist' ? `
  <div class="bg-white rounded-xl p-6 shadow-sm border">
    <h2 class="font-semibold mb-4">â˜‘ï¸ This Week's Checklist</h2>
    <p class="text-gray-500 text-sm mb-4">Click items to mark complete. Resets when you close the week.</p>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      ${Object.entries(WEEKLY_CHECKLIST).map(([day, items]) => {
        const completed = data.week.checklist?.[day] || [];
        const allDone = completed.length === items.length;
        return `
        <div class="border rounded-lg p-4 ${allDone ? 'bg-green-50 border-green-200' : ''}">
          <h3 class="font-bold mb-3 ${allDone ? 'text-green-700' : ''}">${day.charAt(0).toUpperCase() + day.slice(1)} ${allDone ? 'âœ…' : ''}</h3>
          <div class="space-y-2">
            ${items.map((item, idx) => `
            <div onclick="toggleChecklist('${day}',${idx})" class="checklist-item p-2 rounded ${completed.includes(idx) ? 'done bg-gray-100' : 'hover:bg-gray-50'}">
              <span class="text-sm">${completed.includes(idx) ? 'â˜‘ï¸' : 'â˜'} ${item}</span>
            </div>`).join('')}
          </div>
        </div>`;
      }).join('')}
    </div>
  </div>
  ` : ''}

</div>`;
}

// Init
ui.scheduleDay = 'monday';
loadFromCloud();
</script>
</body>
</html>
